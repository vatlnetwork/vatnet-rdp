var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(e,f,g){if(null==e)throw new TypeError("The 'this' value for String.prototype."+g+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+g+" must not be a regular expression");return e+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,f,g){if(e==Array.prototype||e==Object.prototype)return e;e[f]=g.value;return e};
$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<e.length;++f){var g=e[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,f){var g=$jscomp.propertyToPolyfillSymbol[f];if(null==g)return e[f];g=e[g];return void 0!==g?g:e[f]};$jscomp.polyfill=function(e,f,g,a){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,f,g,a):$jscomp.polyfillUnisolated(e,f,g,a))};
$jscomp.polyfillUnisolated=function(e,f,g,a){g=$jscomp.global;e=e.split(".");for(a=0;a<e.length-1;a++){var d=e[a];if(!(d in g))return;g=g[d]}e=e[e.length-1];a=g[e];f=f(a);f!=a&&null!=f&&$jscomp.defineProperty(g,e,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(e,f,g,a){var d=e.split(".");e=1===d.length;a=d[0];a=!e&&a in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var b=0;b<d.length-1;b++){var h=d[b];if(!(h in a))return;a=a[h]}d=d[d.length-1];g=$jscomp.IS_SYMBOL_NATIVE&&"es6"===g?a[d]:null;f=f(g);null!=f&&(e?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:f}):f!==g&&($jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+d,d=
$jscomp.propertyToPolyfillSymbol[d],$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:f})))};$jscomp.polyfill("String.prototype.startsWith",function(e){return e?e:function(f,g){var a=$jscomp.checkStringArgs(this,f,"startsWith");f+="";var d=a.length,b=f.length;g=Math.max(0,Math.min(g|0,a.length));for(var h=0;h<b&&g<d;)if(a[g++]!=f[h++])return!1;return h>=b}},"es6","es3");
function showTwoFAQR(e,f){var g=hi5.$("twofainfo");if(g){var a=hi5.$("barcodeDiv"),d=hi5.$("enableTwoFA"),b=hi5.$("disableTwoFA");f?(hi5.$("imgBarcode").src="data:image/png;base64,"+f,a.style.display="block",b.style.display="none",d.style.display="block"):(a.style.display="none",b.style.display="block",d.style.display="none");var h=new hi5.ui.Lightbox(g);h.show();hi5.$("faCode").focus();hi5.$("faCode").value="";d.onclick=b.onclick=function(k){var c=hi5.$("faCode").value;k=k.target==d?1:0;6!=c.length?
hi5.notifications.notify(__svi18n.info.digit6||"It must be a 6 digit number"):(e(c,k),h.dismiss())}}}
svGlobal.auth=new function(){function e(b){hi5.tool.enableInput();if(b.error)svGlobal.gatewayError(b.name,b.message||b.msg);else{hi5.$("frmLogin").style.display="none";hi5.$("frmConn").style.display="block";for(var h=hi5.$("programs");h.hasChildNodes();)h.removeChild(h.firstChild);var k=b.servers;if(!b.accessNotInList){var c=hi5.$("anyconn");c&&(c.style.display="none")}c=svGlobal.auth.getUserName(hi5.$("user").value);window.__sparkUser={session:b.session,account:c,gateway:hi5.$("gateway").value,servers:k,
twoFA:b.twoFA,twoFAEnabled:b.twoFAEnabled,twoFAQR:b.twoFAQR};b=k.length;if(!(1>b)){c="";for(var l=0;l<b;l++){var r=k[l].server,m=k[l].id;r=k[l].displayName||m||r;var n=k[l].icon;n||(n="rdp32.png");var p=document.createElement("div");p.className="icon";var u=document.createElement("img");u.src=n;u.id=m;u.alt=m;u.title=r;u.style.cursor="pointer";u.onclick=f;p.appendChild(u);p.appendChild(document.createElement("br"));p.appendChild(document.createTextNode(r));h.appendChild(p);hi5.appcfg.startup&&m===
hi5.appcfg.startup.server&&(c=m)}!c&&hi5.appcfg.startup&&(console.log("start up:"+hi5.appcfg.startup.server+" not found, use the first instead"),c=k[0].id);c&&g(c,!hi5.appcfg.startup.newWindow,!0)}}}function f(b){var h=b.target;h.onclick=null;setTimeout(function(){h.onclick=f},300);g(h.id)}function g(b,h,k){var c=window.__sparkUser,l=c.servers,r=l.length;c.server=null;window.sparkGateway=c.gateway;for(var m=0;m<r;m++){var n=l[m];if(b==n.id){n.gateway=c.gateway;n.session=c.session;n.account=c.account;
c.server=n;break}}if(c.server){console.log("connecting to:"+c.server.id);(b=hi5.$("touchpad"))&&b.checked&&(c.server.touchpad=!0);if(b=hi5.$("keyboard"))b=parseInt(b.options[b.selectedIndex].value),0<b&&(c.server.keyboard=b);if(svGlobal.auth.onconnect)svGlobal.auth.onconnect(c.server);c.server.rdp&&c.server.rdp.remoteProgram&&(c.server.startProgram="app");b="width="+window.outerWidth+",height="+window.outerHeight;c.server.http&&window.open("/PXY/"+c.server.id+"/","new-window",b);l="app"==c.server.startProgram;
void 0==h&&(h=l);if(h){var p=svManager.getInstance();if(l&&p&&p.running())p.startApp(c.server.exe||c.server.rdp.remoteProgram,c.server.args||c.server.rdp.remoteArgs,""),d&&d.visible()&&d.dismiss();else{var u=function(q){function w(){null==d&&(d=new hi5.ui.Lightbox(hi5.$("login")));d.visible()?d.dismiss():d.show()}var v=q.toolbar.querySelector("#__sv_btn_home");v||(v=q.toolbar.addButton(hi5.appcfg.img.home||"home.png",w),v.id="__sv_btn_home")};p=new Rdp2(c.server);hi5.$("login").style.display="none";
var t=new svGlobal.LocalInterface;t.onremoteappicon=function(q,w){if(t.toolbar&&q.isMainWin()&&32==w.getWidth()){var v="win"+q.id;if(!t.toolbar.querySelector("#"+v)){u(t);var x=t.toolbar.addButton(w.getDataURL(),function(){q.activate(1)});x.id=v;x.title=q.titleInfo;x.style.width="32px";x.style.height="32px";x.addEventListener("mouseover",function(){x.title=q.titleInfo},!1);setTimeout(function(){q.activate(1)},333)}}};t.onremoteappclose=function(q){t.toolbar&&(q=t.toolbar.querySelector("#win"+q.id))&&
t.toolbar.removeChild(q)};p.addSurface(t);p.run();p.onclose=function(){if(k){window.__sparkUser=null;var q=hi5.$("frmLogin");q.elements.pwd.value="";q.style.display="block";hi5.$("frmConn").style.display="none"}else p.hide(),hi5.$("login").style.display="block"}}}else h=document.getElementById("multiMon"),c.server.rdp?(c.server.rdp.multiMon=h&&h.checked?"on":"off",window.open("rdpdirect.html","new-window",b)):c.server.vnc?window.open("vnc.html","new-window",b):c.server.ssh?window.open("sshdirect.html",
"new-window",b):c.server.telnet&&window.open("telnet.html","new-window",b)}else hi5.notifications.notify("Not a valid server")}var a=this,d=null;this.getLoginURL=function(){return("https:"==location.protocol?"wss://":"ws://")+hi5.$("gateway").value+"/LOGIN?"};this.showLogDlg=function(){window.__sparkUser=null;var b=hi5.$("frmLogin");b.elements.pwd.value="";b.style.display="block";hi5.$("frmConn").style.display="none";(b=svManager.getInstance())&&b.running()&&b.close()};this.getUserName=function(b){hi5.appcfg&&
hi5.appcfg.domain&&(b.toLowerCase().startsWith(hi5.appcfg.domain.toLowerCase()+"\\")||(b=hi5.appcfg.domain+"\\"+b));return b};this.login=function(b){function h(l,r){window.__sparkUser=null;if(!a.beforelogin||!a.beforelogin(l)){hi5.tool.disableInput();var m=new WebSocket(l.substring(0,l.indexOf("?"))+"?_METHOD=post","login");m.onclose=function(n){k||(hi5.notifications.notify(__svi18n.errorCode.connection),a.showLogDlg());hi5.tool.enableInput();a.afterlogin&&a.afterlogin(k);k=!1};m.onopen=function(n){k=
!0};m.onmessage=function(n){var p=n.data,u=p.substring(0,2);if("00"==u)m.send("00"+l.substring(l.indexOf("?")+1));else if("01"==u)switch(hi5.tool.enableInput(),p.substring(2,3)){case "0":if(n=hi5.$("twofacode")){var t=new hi5.ui.Lightbox(n);t.show();var q=hi5.$("btnTwoFACode"),w=hi5.$("faAuthCode");w.focus();w.value="";q.onclick=function(){m.send("code:"+w.value);t.dismiss()};w.addEventListener("keyup",function(v){if(13==v.keyCode||"Enter"==v.code)v.preventDefault(),q.click()})}break;case "1":n=p.substring(4),
showTwoFAQR(function(v,x){m.send("code:"+v)},n)}else n=JSON.parse(n.data),0===n.type&&(n.message||n.name)?svGlobal.gatewayError(n.name,n.message||n.msg):(n.error||m.send("A1"+navigator.userAgent),r(n))}}}var k=!1,c=hi5.browser.cookie2Obj();c.svSession&&c.svEmail&&(b+="&svSession="+c.svSession+"&svEmail="+encodeURIComponent(c.svEmail));setTimeout(function(){h(b,e)},5);return!1}};
window.addEventListener("load",function(e){function f(){e.preventDefault();svGlobal.auth.beforesubmit&&svGlobal.auth.beforesubmit();var a=hi5.$("frmLogin").elements,d=svGlobal.auth.getUserName(a.user.value),b=a.pwd.value;d=svGlobal.auth.getLoginURL()+"user="+encodeURIComponent(d)+"&pwd="+encodeURIComponent(b);(a=a.sharedSecret)&&a.value&&(d+="&sharedSecret="+encodeURIComponent(a.value));return svGlobal.auth.login(d)}function g(a,d){var b=svGlobal.auth.getLoginURL()+"action=code",h=new WebSocket(b,
"login");h.onmessage=function(k){k=JSON.parse(k.data);k.error?svGlobal.gatewayError(k.name,k.message||k.msg):hi5.notifications.notify(__svi18n.info.succeeded);h.close()};h.onopen=function(k){h.send("twof:"+a+"\t"+__sparkUser.account+"\t"+d+"\t"+__sparkUser.session)}}(function(){hi5.$("user").focus();hi5.$("frmLogin").onsubmit=f;var a=hi5.$("anyconn");a&&(a.onclick=function(){var c="width="+window.outerWidth+",height="+window.outerHeight;window.open("rdp.html?gateway="+hi5.$("gateway").value,"new-window",
c)});if(a=document.querySelector('input[name="showlogin"]'))a.onclick=svGlobal.auth.showLogDlg;a=hi5.browser.cookie2Obj();var d=-1!=document.cookie.indexOf("__SV_TOKEN_A"),b=hi5.tool.queryToObj();if(a.svEmail||a.user||d||b.autoLogin||b.user&&b.pwd){var h=hi5.$("frmLogin").elements;h.user.value=a.svEmail||a.user||b.user||"";h.pwd.value=(a.svSession?"fake":a.pwd)||b.pwd||"_";a.gateway&&(h.gateway.value=a.gateway);(h.user.value&&h.pwd.value||a.autoLogin||d||b.autoLogin)&&setTimeout(f,30)}a=hi5.$("settings");
var k=hi5.$("settingsDiv");a&&(a.onclick=function(){if(k){(new hi5.ui.Lightbox(k)).show();hi5.$("currPwd").focus();var c=hi5.$("btnTwoFA");c&&(c.onclick=function(){showTwoFAQR(g,window.__sparkUser.twoFAQR)},0==__sparkUser.twoFA&&c.parentNode.removeChild(c))}});if(a=hi5.$("frmSettings"))a.onsubmit=function(c){c.preventDefault();var l=c.target.elements;if(l.newPwd1.value!=l.newPwd2.value)hi5.notifications.notify(__svi18n.errorCode.pwdmatch);else{c=svGlobal.auth.getLoginURL()+"_METHOD=post&action=put";
var r=new WebSocket(c,"login");r.onmessage=function(m){0==m.data.indexOf("00")?(r.send("00currPwd="+encodeURIComponent(l.currPwd.value)+"&newPwd="+encodeURIComponent(l.newPwd1.value)+"&user="+encodeURIComponent(svGlobal.auth.getUserName(hi5.$("user").value))),hi5.$("frmSettings").reset()):(m=JSON.parse(m.data),m.error&&svGlobal.gatewayError(m.name,m.message||m.msg))};k.dismiss&&k.dismiss();return!1}};a=hi5.$("gateway");(d=a.value)||(d=hi5.appcfg.defaultPort?window.location.hostname+":"+hi5.appcfg.defaultPort:
window.location.host);0==d.length&&(d="localhost");a.value=d;a=hi5.$("touchpadmode");hi5.browser.isTouch&&(a.style.display="");(a=hi5.$("user"))&&!a.value&&hi5.appcfg&&hi5.appcfg.domain&&!hi5.appcfg.hiddenDomain&&(a.value=hi5.appcfg.domain+"\\");(function(){var c=!1,l="";try{document.createElement("canvas").getContext("2d"),c=!0}catch(p){l="This browser does not support Canvas.\n\n"}var r=!("WebSocket"in window)&&!("MozWebSocket"in window),m=navigator.userAgent,n=-1!=m.indexOf("Firefox");r&&(l+="This browser doesn't support WebSocket.\n\n",
n?l+="Please update to Firefox 6 or later.\n\n":-1!=m.indexOf("Opera")?l+="Please open 'opera:config#Enable WebSockets' (type it in the link field) make 'Enable WebSockets' selected and restart Opera.\n\n":-1!=m.indexOf("MSIE")&&(l+="Please install Google Chrome Frame.\n\n"));0<l.length&&hi5.notifications.notify(l);return!r&&c})();(a=hi5.$("defPort"))&&hi5.appcfg.defaultPort&&(a.innerHTML=hi5.appcfg.defaultPort);(a=document.getElementById("frmConn"))&&(a=a.querySelector('select[name="keyboard"]'));
a&&(d=svGlobal.Rdp.languageToKeyboard.detect())&&(a.value=d)})()},!1);
