var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(v,L,P){if(null==v)throw new TypeError("The 'this' value for String.prototype."+P+" must not be null or undefined");if(L instanceof RegExp)throw new TypeError("First argument to String.prototype."+P+" must not be a regular expression");return v+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(v,L,P){if(v==Array.prototype||v==Object.prototype)return v;v[L]=P.value;return v};
$jscomp.getGlobal=function(v){v=["object"==typeof globalThis&&globalThis,v,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var L=0;L<v.length;++L){var P=v[L];if(P&&P.Math==Math)return P}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(v,L){var P=$jscomp.propertyToPolyfillSymbol[L];if(null==P)return v[L];P=v[P];return void 0!==P?P:v[L]};$jscomp.polyfill=function(v,L,P,U){L&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(v,L,P,U):$jscomp.polyfillUnisolated(v,L,P,U))};
$jscomp.polyfillUnisolated=function(v,L,P,U){P=$jscomp.global;v=v.split(".");for(U=0;U<v.length-1;U++){var V=v[U];if(!(V in P))return;P=P[V]}v=v[v.length-1];U=P[v];L=L(U);L!=U&&null!=L&&$jscomp.defineProperty(P,v,{configurable:!0,writable:!0,value:L})};
$jscomp.polyfillIsolated=function(v,L,P,U){var V=v.split(".");v=1===V.length;U=V[0];U=!v&&U in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ka=0;ka<V.length-1;ka++){var Z=V[ka];if(!(Z in U))return;U=U[Z]}V=V[V.length-1];P=$jscomp.IS_SYMBOL_NATIVE&&"es6"===P?U[V]:null;L=L(P);null!=L&&(v?$jscomp.defineProperty($jscomp.polyfills,V,{configurable:!0,writable:!0,value:L}):L!==P&&($jscomp.propertyToPolyfillSymbol[V]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(V):$jscomp.POLYFILL_PREFIX+
V,V=$jscomp.propertyToPolyfillSymbol[V],$jscomp.defineProperty(U,V,{configurable:!0,writable:!0,value:L})))};$jscomp.polyfill("String.prototype.startsWith",function(v){return v?v:function(L,P){var U=$jscomp.checkStringArgs(this,L,"startsWith");L+="";var V=U.length,ka=L.length;P=Math.max(0,Math.min(P|0,U.length));for(var Z=0;Z<ka&&P<V;)if(U[P++]!=L[Z++])return!1;return Z>=ka}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var v={},L=Object.create(new $jscomp.global.Proxy(v,{get:function(P,U,V){return P==v&&"q"==U&&V==L}}));return!0===L.q}catch(P){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.arrayIteratorImpl=function(v){var L=0;return function(){return L<v.length?{done:!1,value:v[L++]}:{done:!0}}};$jscomp.arrayIterator=function(v){return{next:$jscomp.arrayIteratorImpl(v)}};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(v){if(v)return v;var L=function(V,ka){this.$jscomp$symbol$id_=V;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ka})};L.prototype.toString=function(){return this.$jscomp$symbol$id_};var P=0,U=function(V){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new L("jscomp_symbol_"+(V||"")+"_"+P++,V)};return U},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(v){if(v)return v;v=Symbol("Symbol.iterator");for(var L="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P=0;P<L.length;P++){var U=$jscomp.global[L[P]];"function"===typeof U&&"function"!=typeof U.prototype[v]&&$jscomp.defineProperty(U.prototype,v,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return v},"es6",
"es3");$jscomp.iteratorPrototype=function(v){v={next:v};v[Symbol.iterator]=function(){return this};return v};$jscomp.makeIterator=function(v){var L="undefined"!=typeof Symbol&&Symbol.iterator&&v[Symbol.iterator];return L?L.call(v):$jscomp.arrayIterator(v)};$jscomp.owns=function(v,L){return Object.prototype.hasOwnProperty.call(v,L)};
$jscomp.polyfill("WeakMap",function(v){function L(){if(!v||!Object.seal)return!1;try{var N=Object.seal({}),Q=Object.seal({}),ha=new v([[N,2],[Q,3]]);if(2!=ha.get(N)||3!=ha.get(Q))return!1;ha.delete(N);ha.set(Q,4);return!ha.has(N)&&4==ha.get(Q)}catch(Ua){return!1}}function P(){}function U(N){var Q=typeof N;return"object"===Q&&null!==N||"function"===Q}function V(N){if(!$jscomp.owns(N,Z)){var Q=new P;$jscomp.defineProperty(N,Z,{value:Q})}}function ka(N){if(!$jscomp.ISOLATE_POLYFILLS){var Q=Object[N];
Q&&(Object[N]=function(ha){if(ha instanceof P)return ha;Object.isExtensible(ha)&&V(ha);return Q(ha)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(v&&$jscomp.ES6_CONFORMANCE)return v}else if(L())return v;var Z="$jscomp_hidden_"+Math.random();ka("freeze");ka("preventExtensions");ka("seal");var Pa=0,O=function(N){this.id_=(Pa+=Math.random()+1).toString();if(N){N=$jscomp.makeIterator(N);for(var Q;!(Q=N.next()).done;)Q=Q.value,this.set(Q[0],Q[1])}};O.prototype.set=function(N,Q){if(!U(N))throw Error("Invalid WeakMap key");
V(N);if(!$jscomp.owns(N,Z))throw Error("WeakMap key fail: "+N);N[Z][this.id_]=Q;return this};O.prototype.get=function(N){return U(N)&&$jscomp.owns(N,Z)?N[Z][this.id_]:void 0};O.prototype.has=function(N){return U(N)&&$jscomp.owns(N,Z)&&$jscomp.owns(N[Z],this.id_)};O.prototype.delete=function(N){return U(N)&&$jscomp.owns(N,Z)&&$jscomp.owns(N[Z],this.id_)?delete N[Z][this.id_]:!1};return O},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(v){function L(){if($jscomp.ASSUME_NO_NATIVE_MAP||!v||"function"!=typeof v||!v.prototype.entries||"function"!=typeof Object.seal)return!1;try{var O=Object.seal({x:4}),N=new v($jscomp.makeIterator([[O,"s"]]));if("s"!=N.get(O)||1!=N.size||N.get({x:4})||N.set({x:4},"t")!=N||2!=N.size)return!1;var Q=N.entries(),ha=Q.next();if(ha.done||ha.value[0]!=O||"s"!=ha.value[1])return!1;ha=Q.next();return ha.done||4!=ha.value[0].x||"t"!=ha.value[1]||!Q.next().done?!1:!0}catch(Ua){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(v&&$jscomp.ES6_CONFORMANCE)return v}else if(L())return v;var P=new WeakMap,U=function(O){this.data_={};this.head_=Z();this.size=0;if(O){O=$jscomp.makeIterator(O);for(var N;!(N=O.next()).done;)N=N.value,this.set(N[0],N[1])}};U.prototype.set=function(O,N){O=0===O?0:O;var Q=V(this,O);Q.list||(Q.list=this.data_[Q.id]=[]);Q.entry?Q.entry.value=N:(Q.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:O,value:N},Q.list.push(Q.entry),
this.head_.previous.next=Q.entry,this.head_.previous=Q.entry,this.size++);return this};U.prototype.delete=function(O){O=V(this,O);return O.entry&&O.list?(O.list.splice(O.index,1),O.list.length||delete this.data_[O.id],O.entry.previous.next=O.entry.next,O.entry.next.previous=O.entry.previous,O.entry.head=null,this.size--,!0):!1};U.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=Z();this.size=0};U.prototype.has=function(O){return!!V(this,O).entry};U.prototype.get=function(O){return(O=
V(this,O).entry)&&O.value};U.prototype.entries=function(){return ka(this,function(O){return[O.key,O.value]})};U.prototype.keys=function(){return ka(this,function(O){return O.key})};U.prototype.values=function(){return ka(this,function(O){return O.value})};U.prototype.forEach=function(O,N){for(var Q=this.entries(),ha;!(ha=Q.next()).done;)ha=ha.value,O.call(N,ha[1],ha[0],this)};U.prototype[Symbol.iterator]=U.prototype.entries;var V=function(O,N){var Q=N&&typeof N;"object"==Q||"function"==Q?P.has(N)?
Q=P.get(N):(Q=""+ ++Pa,P.set(N,Q)):Q="p_"+N;var ha=O.data_[Q];if(ha&&$jscomp.owns(O.data_,Q))for(O=0;O<ha.length;O++){var Ua=ha[O];if(N!==N&&Ua.key!==Ua.key||N===Ua.key)return{id:Q,list:ha,index:O,entry:Ua}}return{id:Q,list:ha,index:-1,entry:void 0}},ka=function(O,N){var Q=O.head_;return $jscomp.iteratorPrototype(function(){if(Q){for(;Q.head!=O.head_;)Q=Q.previous;for(;Q.next!=Q.head;)return Q=Q.next,{done:!1,value:N(Q)};Q=null}return{done:!0,value:void 0}})},Z=function(){var O={};return O.previous=
O.next=O.head=O},Pa=0;return U},"es6","es3");$jscomp.findInternal=function(v,L,P){v instanceof String&&(v=String(v));for(var U=v.length,V=0;V<U;V++){var ka=v[V];if(L.call(P,ka,V,v))return{i:V,v:ka}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(v){return v?v:function(L,P){return $jscomp.findInternal(this,L,P).i}},"es6","es3");var svManager={getInstance:function(){var v=window.$rdp;return v&&v.running&&v.running()?v:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(v){var L={};L.id=v.id;L.server=v.id;L.displayName=v.displayName||v.id;if(v=v.rdp){for(var P in v)L[P]=v[P];L.user=v.username||"";L.pwd=v.password||"";L.useConsole=v.console||!1;L.legacyMode=v.leagacyMode||v.legacyMode||!1;L.server_bpp=v.color||16;L.exe=v.remoteProgram||"";L.args=v.remoteArgs||"";L.startProgram=0<L.exe.length?"app":L.command&&0<L.command.length?"shell":"noapp"}return L}
function Rdp2(v){v=svGlobal.util.getServerArgs(v);if(!v||!v.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var L=v.gateway||"",P=0,U=0,V=16,ka=1==v.useSSL||"true"==v.useSSL||"on"==v.useSSL||null;v.width&&(P=parseInt(v.width,10));v.height&&(U=parseInt(v.height,10));v.color&&(V=parseInt(v.color,10));v.server_bpp&&(V=parseInt(v.server_bpp,10));v=hi5.browser.obj2url(v);null===ka&&(ka="https:"==location.protocol);return new Rdp((ka?"wss://":"ws://")+L+"/RDP?"+v,P,U,V)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(v,L,P,U){var V,ka;function Z(a){return"on"==a||"true"==a||1==a}function Pa(){var a=l.gateway;l.ongetgatewayaddress&&(a=l.ongetgatewayaddress(a));return a}function O(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function N(a,b){a=K[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function Q(){return E.displayName||E.server||E.symlink||E.id||"undefined"}function ha(a){l.loadbalanceToken||
(l.loadbalanceToken=K.loadbalanceTokenName?K.loadbalanceTokenName+"="+a:"")}function Ua(a,b,d){l.ontitlechange&&(a=l.ontitlechange(a,d));l.setTitle&&a&&(b=b||window,b.document.title=a)}function nb(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return E.invitation||l.showMessage("15 bit color is not supported anymore."),!1;default:return!1}ab=a;b&&(sa?sa.postMessage({type:0,cmd:1,data:a}):fa&&fa.setColor(a));return!0}function fb(a,b,d,e){pa=a;qa=b;Db=Eb=0;Fb=pa-1;Gb=qa-1;Ja&&(pa=(E.waWidth||
hi5.browser.getScreenWidth())|0,qa=(E.waHeight||hi5.browser.getScreenHeight())|0);E.minWidth&&pa<E.minWidth&&(pa=E.minWidth|0);E.minHeight&&qa<E.minHeight&&(qa=E.minHeight|0);pa&=-4;qa&=-4;svGlobal.logger.warn("resolution changed, w:"+pa+" h:"+qa);var c=pa,m=qa;W?W.resize(c,m):W=new Zb(c,m);I.setSize(pa,qa,Ja?"hidden":null);if(d||pa!=a||qa!=b)sa?sa.postMessage({type:0,cmd:2,data:{w:pa,h:qa}}):fa&&fa.setResolution(pa,qa);if(l.onresolutionchange&&!e)l.onresolutionchange(a,b)}function ba(a){!Qa&&oa&&
(sa?(Hb.data=a,"string"!=typeof a?sa.postMessage(Hb,[a]):sa.postMessage(Hb)):fa.writeRawInput(a))}function $b(a){switch(a){case "\r":break;case "\n":l.writeScancode(28);break;case "\t":l.writeScancode(15);break;default:ba("86"+a)}}function Ib(a){var b=this;a||(a=143);this.send=function(d){var e=!!d.buffer,c=e?d:d.getData(),m=64==a;d=e?c.length:d.getEnd()||c.length;d<c.length&&(c=e?c.subarray(0,d):c.slice(0,d));e=m?5:9;d=new Uint8Array(e+d);d[0]=a;if(m)d[1]=b.id,d[2]=b.id>>8,d[3]=b.id>>16,d[4]=b.id>>
24;else{m=b.name;for(var f=Math.min(m.length,8),B=0;B<f;B++)d[1+B]=m.charCodeAt(B)}d.set(c,e);ba(d.buffer)};this.name="";this.count=this.id=this.flags=0}function tb(a){if(l){var b=__svi18n.errorCode[a];l.displayMsg&&b&&l.showMessage(b);0<svGlobal.log&&console.error&&console.error(b||"error code: "+a);if(l.onerror)l.onerror({name:a,message:b})}}function Jb(a){if(l){var b=__svi18n.info[a];b||(b="info "+a);l.displayMsg&&l.showMessage(b);svGlobal.logger.info(b)}}function Kb(){var a=oa;gb=oa=!1;sa?sa.postMessage({type:0,
cmd:3}):fa&&fa.resetStatus();a&&(oa=a)}function Ac(){var a=I.getFocused();a=a?a.getWindow():window;return"&waWidth="+E.waWidth+"&waHeight="+E.waHeight+"&dpWidth="+a.innerWidth+"&dpHeight="+a.innerHeight}function Lb(a){ta||(ta=new hi5.file.UploadManager(new hi5.file.WsFileService(ba)),ta.addEvent("beforeupload",function(b,d,e){if(l.beforeupload)return l.beforeupload(b,d,e)}),ta.addEvent("fileuploaded",function(b,d,e){if(l.onfileuploaded)l.onfileuploaded(b,d,e)}),ta.addEvent("uploaded",function(b,d){if(l.onuploaded)l.onuploaded(b,
d)}),ta.addEvent("uploadingCancelled",function(){if(l.onuploadingCancelled)l.onuploadingCancelled()}));a.setFileHandler(ta)}function ac(a,b,d){var e=!1;this.exe=a;this.args=b||"";this._dir=d||"";var c=this;this.close=function(){!e&&oa&&(e=!0,ba("8C5"+c.exe+"\t"+c.args+"\t"+l.sessionInfo.appInfo.session))}}function Bc(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}
function Cc(){var a=0,b=0,d=new l.GatewayChannel;d.name="MESSGSTB";d.onopen=function(){svGlobal.logger.info("Message Channel open")};d.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var c=e.getByte(),m=e.getLittleEndian16(),f=e.getLittleEndian16();if(0!=c)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(f){case 1:case 4097:f=new RdpBuffer(new Uint8Array(6),0,6);f.setByte(6);f.setByte(1);f.setLittleEndian16(m);f.setLittleEndian16(0);f.markEnd();d.send(f);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:m=e.getLittleEndian16();a+=m;break;case 43:case 1065:case 1577:43==f&&(c=e.getLittleEndian16(),a=a+c+8,e.skipPosition(c));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;c=new RdpBuffer(new Uint8Array(14),0,14);c.setByte(14);c.setByte(1);c.setLittleEndian16(m);c.setLittleEndian16(43==f?3:11);c.setLittleEndian32(e);c.setLittleEndian32(a);c.markEnd();d.send(c);break;case 2112:case 2176:case 2240:m=e.getLittleEndian32();f=e.getLittleEndian32();
e=e.getLittleEndian32();ub={baseRTT:m,bandwidth:f,averageRTT:e};if(l.onnetworkresult)l.onnetworkresult(ub);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(ub);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};d.onclose=function(){svGlobal.logger.info("MSG channel close")};l.addGatewayChannel(d)}function Dc(a,b,d,e,c){Mb.set(a,b);Nb.set(a,e);b="<b>User:&nbsp;</b>"+d+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+c;d=document.createElement("div");
e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);d.appendChild(e);d.innerHTML+=b;d.innerHTML+="<br>";return d}function Ec(a,b){var d=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);d.appendChild(e);d.innerHTML+=b;d.innerHTML+="<br>";return d}function bc(){var a="";E&&Z(E.connectif)&&E.symlink&&"sessionStorage"in window&&(a="SV_"+E.symlink,E.domain&&(a+=E.domain),
E.user&&(a+=E.user));return a}function Fc(){var a=bc(),b="";a&&(b=sessionStorage[a]||"")&&(b="&preSymJoin="+b);return b}function Gc(a,b){var d=0,e=I.size(),c=Array(e),m=Array(e),f=0,B=0,D=0,F=0,S=0,z=0,u="";if(a){m=W.parseMonitorDef(a);for(e=m.length;d<e;d++){var p=m[d];p[0]<D&&(D=p[0]);p[1]<F&&(F=p[1]);p[2]>S&&(S=p[2]);p[3]>z&&(z=p[3])}0>D&&(f=-D);0>F&&(B=-F);p=0>b?[D,F,S,z]:m[b];E.width=p[2]-p[0]+1;E.height=p[3]-p[1]+1;d=I.getSurface(0);d.setMonitor(p[0],p[1],p[2],p[3]);if(f||B)for(p=d.getMousePosition(),
p.left+=f,p.right+=f,p.top+=B,p.bottom+=B,d=0;d<e;d++)p=m[d],p[0]+=f,p[1]+=B,p[2]+=f,p[3]+=B;W.setMonitorLayout(m);0>b&&W.setMonitorCount(0);l.reconnectOnResize=!1;return"&monitorDef="+a+"&width="+E.width+"&height="+E.height}if(1<e&&!Ja){for(I.verifyMonitors();d<e;d++)a=I.getSurface(d),p=a.getMousePosition(),p.left<D&&(D=p.left),p.top<F&&(F=p.top),p.right>S&&(S=p.right),p.bottom>z&&(z=p.bottom),c[d]=p,u&&(u+=","),u+=p.left+":"+p.top+":"+p.right+":"+p.bottom;0>D&&(f=-D);0>F&&(B=-F);for(d=0;d<e;d++){p=
I.getSurface(d).getMousePosition();if(f||B)p.left+=f,p.right+=f,p.top+=B,p.bottom+=B;m[d]=[p.left,p.top,p.right,p.bottom,p.left==f&&p.top==B?1:0]}W.setMonitorLayout(m);l.reconnectOnResize=!1}u&&(svGlobal.logger.warn("MonitorDef:"+u),E.width=S-D+1,E.height=z-F+1,u="&monitorDef="+u+"&width="+E.width+"&height="+E.height);return u}function Hc(){if(!sessionStorage)return"";var a=sessionStorage.getItem("appInfo.session");if(!a)return"";a="&_session="+a;var b=sessionStorage.getItem("appInfo.numericId");
b&&(a+="&_numericId="+b);return a}function Ob(){if(!oa){gb=!1;var a="";if(Qa)ia.init(!1,!0,!1,0,!1,!1);else{a=v+"&width="+pa+"&height="+qa+"&server_bpp="+ab+"&audio="+(ua.available||hi5.browser.isIE)+Fc()+Gc(E.monitorDef,E.monitor);0>v.indexOf("waWidth")&&(a+=Ac());var b=new Date;E.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());if(!E.timezone){var d=hi5.timezone.getTimeZone();d&&(a+="&timezone="+encodeURIComponent(d.standardName))}a+="&time="+b.getTime();void 0==E.soundPref&&(E.soundPref=0,a+=
"&soundPref=0");var e=d=b="";for(e in bb){var c=bb[e];"flags"in c&&(b&&(b+=",",d+=","),b+=c.name,d+=c.flags)}b&&(a=a+("&channelName="+b)+("&channelFlags="+d));b="";for(e in cb)c=cb[e],"flags"in c&&(b&&(b+=","),b+=c.name);b&&(a+="&gwChannelName="+b);if(d=Bc())b=d.account,d=d.session,b&&(a+="&account="+b),d&&(a+="&session="+d);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);E.audioRecord=Z(E.audioRecord)&&hi5.audio.recordable;ia.init(b,!!E.remotefx,E.audioRecord,E.soundPref,
Z(E.mapCamera)&&!!navigator.mediaDevices,Z(E.mapUSB)&&!!navigator.usb);E.audioRecord&&(a+="&audioRecord=on");E.decompressingRDP61&&(a+="&decompressingRDP61=on");0<ia.count&&(a+="&dvcChannels="+ia.names.join(","));hi5.browser.binaryWS()&&(a+="&binary=on");K.existingFile&&(a+="&existingFile="+K.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(Pa());a=l.modifyURL(a);K.copyTextOnly&&Z(E.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+
encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);Z(E.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));a+=Hc()}void 0==K.wsPost&&(K.wsPost=!1);sa?(Qa&&(Qa.onopen=Pb,Qa.onclose=ob,Qa.onmessage=function(f){Qb.data=f.data;sa.postMessage(Qb,[Qb.data])}),sa.postMessage({type:0,cmd:0,data:{addr:a,width:pa,height:qa,server_bpp:ab,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:K.wsPost}})):(fa=new RdpGeneral(Qa||a,pa,qa,ab,W,!1,K.wsPost),
fa.run());sa?sa.addEventListener("message",cc,!1):(fa.onopen=Pb,fa.onmessage=dc,fa.onclose=ob,fa.onerror=tb,fa.oninfo=Jb,fa.onloggedin=Rb,fa.onresolutionchange=function(f,B){fb(f,B,!1,E.monitorDef&&0<=E.monitor?!0:!1)},fa.onAltSecWindows=ec,fa.onMoveCursor=Sb,fa.onCloseSurface=fc,fa.onColorChange=nb,fa.onHistoryReceived=function(){Tb()},fa.onLockKeyState=function(f){if(l.onLockKeyState)l.onLockKeyState(f)});if(a=I.getSurface(I.size()-1))Ja?a&&(a.remoteApp=new ac(E.exe,E.args,"")):Ua(Q(),a.getWindow());
if(E.invitation&&!Z(E.shadow)){var m=null;a&&(m=a.initChat(E.expert));pb=new l.GatewayChannel;pb.name="C_H_A_T";pb.process=function(f){f=f.getUnicodeString(f.getEnd()-f.getPosition(),!0);m&&m.add(f,E.novice)};m&&(m.onchat=function(f){if(oa){var B=Array(2*f.length);B=new hi5.DataBuffer(B,0,B.length);B.setUnicodeString(f);B.markEnd();pb.send(B)}});l.addGatewayChannel(pb)}hi5.browser.isIE&&!qb&&(0==E.playSound||0<l.mode)&&(qb=hi5.browser.loadFlash(K.flash||hi5.libPath+"plugin.swf"))&&(gc=!0)}}function cc(a){a=
a.data;switch(a.type){case 1:switch(a.event){case 0:Pb();break;case 1:ob(a.expected);break;case 2:tb(a.code);break;case 3:Jb(a.code);break;case 4:Rb();break;case 5:fb(a.w,a.h,!1,E.monitorDef&&0<=E.monitor?!0:!1);break;case 6:Sb(a.x,a.y,!0);break;case 7:fc();break;case 8:0==a.id&&Tb();wa&&wa.check(1<a.id?15555:0);break;case 9:nb(a.color);break;case 10:if(l.onLockKeyState)l.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:W.setRGBs(a.x,a.y,a.w,
a.h,a.pixel,a.offset,a.scansize);break;case 3:W.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:W.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:W.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:W.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:W.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:hc(a);break;case 10:dc(a);break;case 11:Ea.attach(a.data,0,a.data.length);ec(Ea,a.size);break;case 12:W.drawText(a.font,a.flags,a.mixmode,
a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:W.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:W.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:W.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:W.putFont(a.font,a.character,a.glyph);break;case 17:W.putCursor(a.idx,a.cursor);break;case 18:W.setCursor(a.idx);
break;case 19:W.getHistory(ba,function(){sa.postMessage({type:0,cmd:7})});wa&&wa.check(15555);break;case 20:Ea.attach(a.data,a.off,a.data.length-a.off);W.setHistory(a.order,Ea);break;case 21:W.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function ic(a){wa&&wa.check(a)}function Pb(){oa=!0;var a="87"+navigator.userAgent+"\t";vb=hi5.tool.uuid();document.cookie=vb+"=sv";ba(a+vb);if(l.onopen)l.onopen();K.joinCloseMode&&l.setJoinCloseMode(K.joinCloseMode)}
function fc(){I&&I.close()}function dc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ea.attach(a,0,b.byteLength);var d=Ea.getLittleEndian16();switch(d){case 28:a=Ea;b=a.getAscllString(8);d=cb[b];null!=d?d.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ea;switch(a.getByte()){case 0:V=a.getLittleEndian16();ka=a.getLittleEndian16();Wa=a.getLittleEndian32();a.skipPosition(6);db=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+V+" channels="+ka+" bitsPerSample="+
db+" samplePerSec="+Wa);jc();break;case 1:Ic(a)}wa&&wa.check();break;case 56:kc(Ea.getUnicodeString(Ea.getEnd()-Ea.getPosition(),!1));break;case 60:lc(Ea);break;case 62:mc(Ea.getUnicodeString(Ea.getEnd()-Ea.getPosition(),!1));break;case 63:nc(Ea);wa&&wa.check();break;case 64:b=Ea;d=b.getByte();a=b.getLittleEndian32();switch(d){case 1:b=b.getAscllString();if(ia[b]&&(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),ia[b].newInstance?(ia[a]=ia[b].newInstance(),ia[a].id=a):(ia[b].id=a,ia[a]=ia[b]),
ia[a].onopen))ia[a].onopen();break;case 3:ia[a]&&ia[a].process(b);break;case 4:if(ia[a]&&ia[a].onclose)ia[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}wa&&wa.check();break;case 146:a:switch(a=Ea,b=a.getByte(),b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ba(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(Ra^=65536,I.execute("setFeature",[Ra]));break;case 6:xa.remoteLockFlags=a.getLittleEndian32();xa.checkLockFlags=!0;if(l.onLockKeyState)l.onLockKeyState({capsLock:0!=
(xa.remoteLockFlags&4),numLock:0!=(xa.remoteLockFlags&2),scrollLock:0!=(xa.remoteLockFlags&1)},{capsLock:0!=(xa.localLockFlags&4),numLock:0!=(xa.localLockFlags&2),scrollLock:0!=(xa.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+xa.remoteLockFlags);break;case 7:b=a.getByte();l.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();d=a.getLittleEndian32();a=a.getBytes(d);l.sessionInfo.appInfo.twoFAQR=a;l.ontwofaqr&&l.ontwofaqr(a)||2==b&&I.execute("showTwoFAQR");break;case 1:W.pause(!0,
!0);if(l.ontwofacode&&l.ontwofacode())break a;(a=I.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!l.ontwofaresult||!l.ontwofaresult(b,a))&&xa.onauthcoderesult)xa.onauthcoderesult(b,a)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}break;default:if(l.onunknownmessage)l.onunknownmessage(d,Ea);else svGlobal.logger.warn("@TODO:"+d+"\n")}}else switch(d=parseInt(b.substring(0,2),16),a=b.substring(2),d){case 0:ba("87"+navigator.userAgent);break;case 15:if(l){Ub=
!1;jb=l.reconnectTimes;(l&&0==l.mode||Z(E.connectif))&&Tb();b="";for(b in bb)if((d=bb[b])&&d.onopen)d.onopen();for(b in cb)if((d=cb[b])&&d.onopen)d.onopen();a&&(a=JSON.parse(a),a.capability&&l&&(l.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(l.onnotify)l.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&l.onerror)l.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+
b.msg;l.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:I.drawLicense(a);break;case 50:if(oa)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Jc(a);break;case 2:rb?(rb.type==a?l.writeRawInput("881"+a+"\t"+rb.text):l.writeRawInput("881ERROR\t"),rb=null):!(b=I.getFocused())||b.processClipReq(a)||!K.clipWarnAlways&&oc||!E||E.leagacyMode||(l.showMessage(__svi18n.info.menucopy,null,5E3),oc=!0);break;case 5:(b=I.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;
case 51:I.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=Pa()+b[0];a=l.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);l.onprintingready&&l.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=I.getFocused())&&b.showPDF(a);break;case 55:b=parseInt(a.substring(0,1),16);a=a.substring(1);switch(b){case 0:a=a.split("\t");V=parseInt(a[0],10);ka=parseInt(a[1],10);db=parseInt(a[2],10);Wa=parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+
V+" channels="+ka+" bitsPerSample="+db+" samplePerSec="+Wa);jc();break;case 1:Kc(a)}break;case 56:kc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=I.getWinById(parseInt(b[0]))){if(!I.hasApp(b[1])){(d=I.getOwnerSurface(a))&&d.railWin&&(d.railWin.appId=b[1],d.railWin.addApp(b[1]));if(l.onremoteappstart)l.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&l.ontitlechange)l.ontitlechange(d.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Lc(a);break;case 59:a=hi5.Base64.dec(a,
0);Ra=(new RdpBuffer(a,0,a.length)).getLittleEndian32();Xa||!(Ra&16||Ra&65536)?(wb=!1,ta=null):(Ra&16&&(wb=!0),ta||(a=I.getFocused())&&Lb(a));Ra&64&&l.showMessage(__svi18n.info.recording);ta&&(ta.setUpload(!(Ra&128)),ta.setDownload(!(Ra&131072)),ta.canCopyFile=0!=(Ra&65536));I.execute("setFeature",[Ra]);break;case 60:lc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:fb(a.width,a.height,!0,!1);nb(a.color);(b=a.server)&&l&&(l.server=a.server);pc=a.length;d=I.getFocused();Ja=1==
a.isRail;d&&(d.setAutoScale(!Ja),b&&Ua(Q(),d.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&d.setUnicode(!0),b=a.mapDisk)&&(wb=!0,Lb(d));if(l.onopened)l.onopened(a);break;case 1:a=a.duration;if(l.onprogress)l.onprogress(a,pc);break;case 2:2==a.status?(Kb(),oa=!0):(b=0==a.status,b==W.isPaused()||l.onsessionpause&&l.onsessionpause(b,a)||(W.pause(b),b||I.repaint(0,0,W.width-1,W.height-1),a.warn&&l.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:mc(a);break;
case 63:nc(b64ToBuffer(a));break;default:if(l.onunknownmessage)l.onunknownmessage(d,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function Tb(){if(!Xa&&!Ka&&(Ka=!0,l&&(K.pingInterval&&l.startPing(K.pingInterval),l.onready)))l.onready()}function Mc(a,b){var d=0,e=!1;this.width=a;this.interval=b;var c=0;this.start=function(){e||(e=!0,d=setInterval(function(){var m=I.getFocused();m&&oa&&(m=m.getThumbnail(a))&&m.length!=c&&(ba("8E7"+m),c=m.length)},b))};this.stop=function(){clearInterval(d)}}function Nc(a,
b){!Ma||Ma.width==a&&Ma.interval==b||(Ma.stop(),Ma=null);Ma||(Ma=new Mc(a,b));Ma.start()}function nc(a){var b=a.getAscllString(8);(b=bb[b])&&b.process&&b.process(a)}function mc(a){var b=parseInt(a.substring(0,1),16),d=a.substring(1);a=!1;var e=l.sessionInfo.appInfo;switch(b){case 0:var c=JSON.parse(d);Kb();oa=!0;a=c.width;e=c.height;if(a==pa&&e==qa)break;fb(a,e,!1,!1);break;case 1:c=JSON.parse(d);l.sessionInfo.joinedSessions.push(c.numericId);l.sessionInfo.joiners.push(c);e.sessions[c.numericId]=
c.name||c.__ip;if(!e.joined||K.alertJoin)l.onsessionjoin&&(a=l.onsessionjoin(c)),!a&&__svi18n.info.joinsession&&l.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 2:c=JSON.parse(d);l.sessionInfo.joinedSessions.removeElm(c.numericId);delete e.sessions[c.numericId];b=l.sessionInfo.joiners;d=0;for(var m=b.length;d<m;d++)if(b[d].numericId==c.numericId){b.splice(d,1);break}if(!e.joined||K.alertJoin)l.onsessionexit&&(a=l.onsessionexit(c)),!a&&__svi18n.info.exitsession&&
l.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 3:c=JSON.parse(d);e.joinMode!=c.mode&&(e.joinMode=c.mode,b=hi5.$("joinSelect"))&&(b.value=c.mode);if(e.hasControl)break;e.hasControl=!0;I.setReadOnly(!1,2==c.mode);if(e=hi5.$("requestControl"))e.disabled=!0;l.ongivecontrol&&(a=l.ongivecontrol());if(a)break;l.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:c=JSON.parse(d);I.setReadOnly(!0,2==c.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=
!1;l.ontakebackcontrol&&(a=l.ontakebackcontrol());if(a)break;l.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:c=JSON.parse(d);l.onrequirecontrol&&(a=l.onrequirecontrol(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);e=__svi18n.info.recontrol;W.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));l.showMessage({title:a,msg:e,cbYes:function(){l.giveControl(c.numericId);this.destroy();W.isPaused()&&l.pauseSession(l.sessionInfo.appInfo.numericId,!1)},cbNo:function(){l.refuseControl(c.numericId);
this.destroy()}});break;case 6:I.execute("setTouchRemoting",[!0]);break;case 7:c=JSON.parse(d);c.width&&c.height&&fb(c.width,c.height,!0,E.monitorDef&&0<=E.monitor?!0:!1);c.color&&(nb(c.color,!0),svGlobal.logger.warn("Color depth changed to:"+c.color));c.version&&(l.sessionInfo.protocolVersion=c.version);break;case 8:c=JSON.parse(d);Ub=!0;if(l.onrequestcredential&&l.onrequestcredential(c,xa.reconnect))break;if(l.onautherror&&l.onautherror(c,xa.reconnect))break;I.getFocused().requestCredential(c,xa.reconnect);
break;case 9:c=JSON.parse(d);0<c.interval&&0<c.width?Nc(c.width,c.interval):Ma&&(Ma.stop(),Ma=null);break;case 11:c=JSON.parse(d);l.onrequirejoin&&(a=l.onrequirejoin(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);l.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){l.allowJoin(c.numericId,!0);this.destroy()},cbNo:function(){l.allowJoin(c.numericId,!1);this.destroy()}});break;case 13:c=JSON.parse(d);"login"==c.type&&Rb();break;case 14:if(c=JSON.parse(d),l.oncontrolchange)l.oncontrolchange(c)}}
function lc(a){switch(a.getByte()){case 32:if(!W.isPaused()){var b=a.getLittleEndian16(),d=a.getLittleEndian16(),e=a.getLittleEndian16(),c=void 0,m=void 0;K.noCursorName||(c=a.getLittleEndian32(),l.sessionInfo.appInfo&&(m=l.sessionInfo.appInfo.sessions[c]));Sb(d,e,!0,m,c,b)}}}function Sb(a,b,d,e,c,m){W.isPaused()||I.getFocused().moveCursor(a,b,d,e,c,m)}function hc(a){I.setCursor(a)}function Oc(a){var b=K.page&&K.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+
b;var d=location.href,e=d.lastIndexOf("/");if(b)return d.substring(0,e+1)+b;b=Pa();d.toLowerCase().startsWith(b.toLowerCase())&&(b=d.substring(0,e));return b+"/"+a}function kc(a){a=JSON.parse(a);Vb=a.session;var b=a.numericId;sessionStorage&&(sessionStorage.setItem("appInfo.session",Vb),sessionStorage.setItem("appInfo.numericId",b));ha(a.appId);a.server||(a.server=Q());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?I.execute("setAutoScale",
[!0]):(l.mode=0,Z(E.connectif)&&I.setSize(pa,qa),K.disableJoinedAppResize&&(l.windowState=0));var d=Pa();b=Oc("join.html")+"?id="+(a.joined||a.numericId);var e=a.webAddress;e&&0<e.length&&e.toLowerCase()!=d.toLowerCase()&&(d=e.indexOf("://"),l.protocol="http"==e.substring(0,d)?"ws":"wss",l.gateway=e,b+="&gateway="+encodeURIComponent(e));b=l.modifyURL(b);a.joinLink=b;l.sessionInfo.appInfo=a;"isApp"in a&&Ja!==a.isApp&&(Ja=a.isApp,fb(pa,qa,!0,!0),gb||I.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&
svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);K.cursorNameOnly=a.isAssistance;if(l.onsessionstart)l.onsessionstart(l.sessionInfo)}function Lc(a){if(ta){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)ta.notifyFiles(JSON.parse(a));else{var d=a.split("\t");switch(b){case 1:ta.confirmId(d[0],d[1],d[2]);break;case 2:ta.read(d[0],parseInt(d[1],10),parseInt(d[2],10));break;case 4:ta.close(d[0]);break;case 9:a='<a href="'+l.modifyURL(Pa()+d[0])+'" download="'+d[1]+'" target="_blank">'+
__svi18n.info.fileReady+": "+d[1]+"</a>",__svi18n.info.download&&I.getFocused().showMessage({msg:a,title:__svi18n.info.download,cbNo:function(){ta.removeFile(d[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function Kc(a){function b(J){var H=0;J*=m;for(f=0;f<m;f++)H|=(c[J+f]&255)<<8*f;H>B?(H-=F,H/=-D):H/=B;return H}if(ua.available&&!W.isPaused()){var d=a.indexOf("\t"),e=a.substring(0,d),c=hi5.Base64.dec(a,d+1);1!=V&&(kb||(kb=new MSGSM),c=kb.decode(c,0,c.length));
a=db;var m=a>>3,f=0,B=Math.pow(2,a-1)-1,D=-B-1,F=Math.pow(2,a);a=0;d=ka;var S=Math.floor(Math.floor(c.length/m)/d),z=ua.getBuffer(S),u=z.getChannelData(0),p=z.getChannelData(1);for(a=0;a<S;){var A=2*a,r=b(A);1==d?(u[a]=r,p[a]=r):(u[a]=r,p[a]=b(A+1));a++}a=ua.playBuffer(z);setTimeout(function(J){return function(){ba("8A"+J)}}(e),1E3*(a-ua.delay))}}function Ic(a){function b(m){return function(){ba("8A"+m)}}var d=a.getByte(),e=a.getLittleEndian16(),c=Date.now();a.skipPosition(8);a=Wb(a,d,e,0);a=1E3*
(a-ua.delay);Xa||(e+=Date.now()-c+a,setTimeout(b(d+","+e),a))}function Wb(a,b,d,e){if(!gc||W.isPaused())return 0;var c=d=0,m=a.getPosition();b=a.getData();e||(e=a.getEnd()-m);var f=e;if(41222==V)return(d=ua.getContext())&&d.decodeAudioData(b.buffer.slice(m),function(u){u=ua.playBuffer(u);Xa||setTimeout(sendLater(Jb),1E3*(u-ua.delay))},function(u){svGlobal.logger.warn(u)}),0;if(c=1!=V)kb||(kb=new MSGSM),b=kb.decode(b,m,f),m=0,f=b.length;var B=db,D=B>>3,F=Math.floor(f/D),S=a=0,z=0;c||(a=Math.pow(2,
B-1)-1,S=-a-1,z=Math.pow(2,B));B=ka;if(qb){m="";if(c){for(;d<f;d++)0<d&&(m+=","),m+=b[d]+","+b[d]+","+b[d]+","+b[d];qb.write(m);return e/65*.025}for(;d<f;)0<d&&(m+=","),c=b[d++]|b[d++]<<8,9>c?c=0:c>a?(c-=z,c/=-S):c/=a,m+=c,1==B&&(m+=","+c);qb.write(m);return e/D/Wa*.6}e=m;m=Math.floor(F/B);f=ua.getBuffer(m);D=f.getChannelData(0);F=f.getChannelData(1);d=0;if(c)for(;d<m;)1==B?F[d]=D[d]=b[e++]:(D[d]=b[e++],F[d]=b[e++]),d++;else for(;d<m;)c=b[e++]|b[e++]<<8,c>a?(c-=z,c/=-S):c/=a,1==B?D[d]=c:(D[d]=c,c=
b[e++]|b[e++]<<8,c>a?(c-=z,c/=-S):c/=a),F[d]=c,d++;return ua.playBuffer(f)}function jc(){sa&&sa.postMessage({type:0,cmd:5,data:{tag:V,channels:ka,samplePerSec:Wa,bitsPerSample:db}})}function qc(a){if(!l.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var d=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");d||(0==a.indexOf("www.")?(d=!0,a="http://"+a):
0==a.indexOf("ftp.")&&(d=!0,a="ftp://"+a));return d?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:l.onurlredirection&&l.onurlredirection(b)?!0:(a=I.getFocused())?a.processLink(b):!1:!1}function Pc(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var d=a.indexOf('"',b),e=a.substring(b,d);e=l.modifyURL(e);a=a.substring(0,b)+e+a.substring(d)}}return a}function Jc(a){if("text/plain;"!=a){if(1666<Date.now()-xa.reqCopyTime&&!(l.onservercopy&&l.onservercopy(a)||qc(a))){var b=
I.getFocused();b&&b.copyToClip(Pc(a))}setTimeout(function(){ba("883")},999)}}function Rb(){if(!gb&&(setTimeout(function(){oa&&ba("884")},333),l.onloggedin))l.onloggedin();Xb=gb=!0;Ja&&I.execute("setAutoScale",[!1]);ta&&(ta.enabled=!0);xb&&!Ja&&(W.setContext(I.getFocused().context),I.repaint(0,0,W.width-1,W.height-1))}function ob(a){if(l){hi5.browser.cookie.delete(vb);svGlobal.logger.warn("closed "+(l.sessionInfo.appInfo?l.sessionInfo.appInfo.numericId:0));l.onagentmessage&&(l.onagentmessage=null);
if(l.onagentclose)l.onagentclose();var b=bc();b&&l.sessionInfo.appInfo&&0==l.mode&&(sessionStorage[b]=l.sessionInfo.appInfo.session);if(l&&(b=0==l.mode,!oa&&b&&tb("connection"),b=b&&(oa||jb<l.reconnectTimes)&&0<jb&&!a,Ka=oa=!1,b)){jb--;__svi18n.info.reconnecting&&l.showMessage(__svi18n.info.reconnecting+" "+(l.reconnectTimes-jb)+"/"+l.reconnectTimes,null,3E3);setTimeout(Ob,5);svGlobal.logger.info("Reconnecting..."+jb);return}if(Ub)svGlobal.logger.info("Req credential");else{wa&&(l.stopPing(),wa=null);
sa&&(sa.removeEventListener("message",cc,!1),sa.postMessage({type:0,cmd:4}),sa.terminate(),sa=null);ta&&(ta.release(),ta=null);ya=v=null;ia&&(ia.close(),ia=null);bb&&hi5.Arrays.release(bb);cb&&hi5.Arrays.release(cb);Ma&&(Ma.stop(),Ma=null);ua&&(ua.close(),ua=null);sb=null;try{if(l.onclose)l.onclose(a);else svGlobal.logger.info("onclose: null");I&&(I.close(),I=null)}catch(d){svGlobal.logger.warn(d)}Ea=null;fa&&(fa.onopen=null,fa.onmessage=null,fa.onclose=null,fa.onerror=null,fa.close(),fa=null);I=
xa=null;W&&(W.release(),W=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(l.close):window.removeEventListener("unload",l.close,!1);window&&window.$rdp==l&&(window.$rdp=null);l=null}}}function rc(){fa&&oa?fa.close():ob(!0)}function ec(a,b){var d=a.getLittleEndian32();if(0!=(d&16777216))if(b=a.getLittleEndian32(),0!=(d&1073741824)){a.getLittleEndian16();a.getByte();d=a.getByte();var e=a.getLittleEndian16(),c=a.getLittleEndian16(),m=0;16>d&&(m=a.getLittleEndian16());var f=a.getLittleEndian16(),
B=a.getLittleEndian16();a.getBytes(f);m&&a.getBytes(m);if(8<=d&&(m=I.getFocused())&&m.onremoteappicon){f=new hi5.graphic.Bitmap(e,c,32);a.getPosition();e=new Uint8Array(e*c*4);c=a.getPosition();B=c+B;var D;a=a.getData();for(var F=0,S,z;c<B;)switch(d){case 16:(D=a[c++]|a[c++]<<8)?(z=D>>7&248,S=D>>2&248,D=D<<3&248,z|=z>>5,S|=S>>5,D|=D>>5,e[F++]=D,e[F++]=S,e[F++]=z,e[F++]=255):F+=4;break;case 32:e[F++]=a[c++],e[F++]=a[c++],e[F++]=a[c++],e[F++]=a[c++]}f.putPixels(e,0,e.length);a=I.getWinById(b);m.onremoteappicon(a,
f)}}else 0!=(d&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(d&536870912)?(svGlobal.logger.info("***** delete winId="+b),I.delWin(b)):Qc(a,d,b);else if(0!=(d&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+d);else if(0!=(d&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+d),0!=(d&1))svGlobal.logger.info("Desktop non monitored flags="+d);else{if(0!=(d&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+d+" winId="+
b),(m=I.getOwnerSurfaceById(b))&&m.railWin&&m.railWin.setActiveWinId(b),I.setTitle(b),W.getContext()||(b=I.getFocused())&&W.setContext(b.context),0!=(d&16)&&(b=a.getByte(),0<b)))for(d=I.zOrders,d.length=b,m=0;m<b;m++)d[m]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+d[m])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+d)}function sc(a){var b=I.getFocused();if(b&&b.railWin){var d=a||b.railWin.mainWin;if(d&&2<d.showState&&l.windowState){var e=b.getFreeSpace();a=Math.max(Math.abs(d.winHeight-
e.height),Math.abs(d.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+d._hOffset+" appId:"+d.appId+" spaceH:"+e.height);0<a?(b=a==d._hOffset,d._hOffset&&b||(d._hOffset=a,setTimeout(function(){d.resize(0,0,e.width,e.height)},333))):d._hOffset=0}}}function Qc(a,b,d){Ja||(Ja=!0);var e=0==(b&268435456),c=I.getWinById(d);c?e=!0:c=new I.LocalWin(d);svGlobal.logger.info("\n\n=========== winId="+d+" existed="+e);if(c){0!=(b&2)&&(c.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+
c.ownerWinid));0!=(b&8)&&(c.style=a.getLittleEndian32(),c.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" style="+c.style+" extStyle="+c.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(c.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(c.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(c.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(c.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=
(c.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(c.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(c.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(c.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(c.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(c.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(c.style&1073741824))),
svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(c.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(c.extStyle&524288))));0!=(b&16)&&(c.setShowState(a.getByte()),svGlobal.logger.info("***** winId="+d+" showState="+c.showState),2==c.showState&&0!=K.noMinimize&&setTimeout(function(){c.exeCommand(61728)},50));var m=0!=(b&4);if(m){var f=a.getLittleEndian16();c.titleInfo=a.getUnicodeString(f,!1);svGlobal.logger.info("***** winId="+
d+" title="+c.titleInfo)}0!=(b&16384)&&(c.clientOffsetX=a.getLittleEndian32(),c.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" coffX"+c.clientOffsetX+" coffY="+c.clientOffsetY));0!=(b&65536)&&(c.clientAreaWidth=a.getLittleEndian32(),c.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" cw"+c.clientAreaWidth+" ch="+c.clientAreaHeight));0!=(b&131072)&&(c.rpContent=a.getLittleEndian32());0!=(b&262144)&&(c.rootParentHandle=a.getLittleEndian32());
if(0!=(b&2048)){f=a.getLittleEndian32();var B=a.getLittleEndian32();c.winOffsetX=f;c.winOffsetY=B;svGlobal.logger.info("***** winId="+d+" offX"+c.winOffsetX+" offY="+c.winOffsetY)}0!=(b&32768)&&(c.winClientDeltaX=a.getLittleEndian32(),c.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" dX"+c.winClientDeltaX+" dY="+c.winClientDeltaY));0!=(b&1024)&&(c.winWidth=a.getLittleEndian32(),c.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" w"+c.winWidth+" h="+
c.winHeight));if(!e)if(c.isMainWin()||3==c.showState)sc(c);else if(2<c.showState&&(f=I.getFocused())){f=f.getFreeSpace();var D=c.winWidth,F=c.winHeight;if(c.winOffsetX>f.width||c.winOffsetY>f.height||0>D+c.winOffsetX||0>F+c.winOffsetY){var S=(f.width-c.winWidth)/2|0,z=(f.height-c.winHeight)/2|0;0>S&&(S=0);0>z&&(z=0);setTimeout(function(){c.resize(S,z,D,F)},50)}}0!=(b&256)&&(f=a.getLittleEndian16(),0<f&&a.skipPosition(8*f));0!=(b&4096)&&(c.visibleOffsetX=a.getLittleEndian32(),c.visibleOffsetY=a.getLittleEndian32());
0!=(b&512)&&(b=a.getLittleEndian16(),c.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)I.onWinChange(c);else I.addWin(c);m&&I.setTitle(d)}else svGlobal.logger.warn("XXX, No win with id:"+d)}function Zb(a,b){function d(h,k,g,n,q){0<q.width?q.union(h,k,g,n):(q.x=h,q.y=k,q.width=g,q.height=n)}function e(h,k,g,n){for(za=0;za<Fa;za++){var q=ea[za];if(h>=q[0]&&k>=q[1]&&g<=q[2]&&n<=q[3])return Ga[za]}return null}function c(h,k,g,n){if(Fa){var q=e(h,k,h+g-1,k+n-1);q&&d(h,k,g,n,q)}else d(h,k,g,n,r)}function m(h,
k,g,n,q,t,x){for(var w=q*g+n,y=h.setRGB,G=h.getRGB,C=0;C<x;C++){for(var M=0;M<t;M++){if(h){var ma=G(n+M,q+C);y(n+M,q+C,~ma&16777215)}else k[w]=~k[w]&16777215;w++}w+=g-t}}function f(h,k,g,n,q,t,x,w,y,G){k=G*w+y;null==x&&(x=h);for(h=0;h<t;h++){for(y=0;y<q;y++)p[n+h][g+y]=p[n+h][g+y]&x[k]&16777215|4278190080,k++;k+=w-q}}function B(h,k,g,n,q,t,x,w,y,G){k=G*w+y;y=h.setRGB;G=h.getRGB;null==x&&(x=h);for(h=0;h<t;h++){for(var C=0;C<q;C++){var M=G(g+C,n+h);y(g+C,n+h,M|x[k]&16777215);k++}k+=w-q}}function D(h,
k,g,n){var q=Ba;if(q){var t=q.getRGB(k,g);switch(h){case 0:q.setRGB(k,g,0);break;case 1:q.setRGB(k,g,~(t|n)&16777215);break;case 2:q.setRGB(k,g,t&~n&16777215);break;case 3:q.setRGB(k,g,~n&16777215);break;case 4:q.setRGB(k,g,16777215*(~t&n));break;case 5:q.setRGB(k,g,~t&16777215);break;case 6:q.setRGB(k,g,t^n&16777215);break;case 7:q.setRGB(k,g,~t&n&16777215);break;case 8:q.setRGB(k,g,t&n&16777215);break;case 9:q.setRGB(k,g,t^~n&16777215);break;case 10:break;case 11:q.setRGB(k,g,t|~n&16777215);break;
case 12:q.setRGB(k,g,n);break;case 13:q.setRGB(k,g,(~t|n)&16777215);break;case 14:q.setRGB(k,g,t|n&16777215);break;case 15:q.setRGB(k,g,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+h),q.setRGB(k,g,n)}}}function F(h,k,g,n,q,t,x,w,y){h>w||k>y||(g=h+g-1,g>w&&(g=w),h<t&&(h=t),g=g-h+1,n=k+n-1,n>y&&(n=y),k<x&&(k=x),n=n-k+1,1>g||1>n||Ba.fillRect(h,k,g,n,q))}function S(h,k,g,n,q,t,x,w,y,G,C,M){if(!(k>C||g>M)){var ma=k+n-1;ma>C&&(ma=C);y=k<y?y:k;ma=ma-k+1;C=g+q-1;C>M&&(C=M);G=
g<G?G:g;M=C-g+1;if(!(1>ma||1>M)){C=128;var ca=0;x|=4278190080;w|=4278190080;if(y==k&&G==g&&ma==n&&M==q)if(0==h)for(var aa=0;aa<q;aa++){h=g+aa;for(var la=0;la<n;la++)0==C&&(ca++,C=128),0!=(t[ca]&C)&&(p[h][k+la]=w),C>>=1;ca++;C=128;ca==t.length&&(ca=0)}else for(aa=0;aa<q;aa++){h=g+aa;for(la=0;la<n;la++)0==C&&(ca++,C=128),p[h][k+la]=0!=(t[ca]&C)?w:x,C>>=1;ca++;C=128;ca==t.length&&(ca=0)}else if(0==h)for(aa=0;aa<M;aa++){h=g+aa;for(la=0;la<ma;la++)0==C&&(ca++,C=128),k+la>=y&&h>=G&&0!=(t[ca]&C)&&(p[h][k+
la]=w),C>>=1;ca++;C=128;ca==t.length&&(ca=0)}else for(aa=0;aa<M;aa++){h=g+aa;for(la=0;la<ma;la++)0==C&&(ca++,C=128),k+la>=y&&g+aa>=G&&(p[h][k+la]=0!=(t[ca]&C)?w:x),C>>=1;ca++;C=128;ca==t.length&&(ca=0)}}}}function z(h,k,g,n,q){this.offset=h;this.baseLine=k;this.width=g;this.height=n;this.fontData=q}function u(h,k,g,n,q,t,x,w,y){this.cache_idx=h;this.rawData=k;this.none=!k;this.hotX=g;this.hotY=n;this.width=q;this.height=t;this.xorSize=w;this.andSize=y;this.result="";this.distance=0;this.bpp=x;this.system=
"";if(k){if(!this.distance){h=0;if(k){x=0;for(var G=k.length;x<G;x++)0!=k[x]&&(h+=x%q+(x/q|0))}this.distance=h}if(!this.system){a:switch(this.distance){case 507:h="text";break a;case 2046:case 4359:h="default";break a;default:h=""}this.system=h}}h="";if(!this.system&&k){x=q*t*4;h=62+x+w+y;G=new Uint8Array(h);h=new hi5.DataBuffer(G,0,h);h.setLittleEndian16(0);h.setLittleEndian16(2);h.setLittleEndian16(1);h.setByte(q);h.setByte(t);h.setByte(0);h.setByte(0);h.setLittleEndian16(g);h.setLittleEndian16(n);
h.setLittleEndian32(40+x+w+y);h.setLittleEndian32(22);h.setLittleEndian32(40);h.setLittleEndian32(q);h.setLittleEndian32(2*t);h.setLittleEndian16(1);h.setLittleEndian16(32);h.setLittleEndian32(0);h.setLittleEndian32(w+y);h.setLittleEndian32(0);h.setLittleEndian32(0);h.setLittleEndian32(0);h.setLittleEndian32(0);for(g=t-1;0<=g;g--)for(n=0;n<q;n++)t=k[q*g+n],h.setByte(t&255),h.setByte(t>>8&255),h.setByte(t>>16&255),h.setByte(t>>24&255);h="data:image/x-icon;base64,"+hi5.Base64.enc(h.getData())}this.url=
h}var p=[],A=null,r=new hi5.graphic.Rectangle(0,0,0,0),J="Uint8ClampedArray"in window,H=null,R=0,T=0,ja=0,na=0,Y=null,ea,Ga,za=0,Fa=0;this.width=a;this.height=b;var Ya=!1,Ba=this,Ca={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(h){H=h};this.getDirtyArea=function(){return r};this.setImgRect=function(h,k,g,n){R=h;T=k;ja=g;na=n};this.parseMonitorDef=function(h){var k=h.split(","),g=k.length,n=[];if(1<g){for(var q=!1,t=0;t<g;t++){var x=k[t].split(":");if(4==x.length)n[t]=Array(5),
n[t][0]=parseInt(x[0]),n[t][1]=parseInt(x[1]),n[t][2]=parseInt(x[2]),n[t][3]=parseInt(x[3]),n[t][4]=0==n[t][0]&&0==n[t][1]?1:0;else{q=!0;break}}q&&(svGlobal.logger.warn("invaiid monitorDef:"+h),n.length=0)}return n};this.setMonitorLayout=function(h){var k=h.length,g=0;ea=h;for(Ga=Array(k);g<k;g++)Ga[g]=new hi5.graphic.Rectangle(0,0,0,0);Fa=k};this.setMonitorCount=function(h){Fa=h};this.addImg=function(h){ja&&(Y&&URL.revokeObjectURL(Y.src),Y=h)};this.flushImgs=function(){Y&&(URL.revokeObjectURL(Y.src),
Y=null,ja=0)};this.getData=function(){return p};this.pause=function(h,k){Ya=h;k&&A&&A.fillRect(0,0,a,b)};this.release=function(){r=null;hi5.Arrays.release(Ga);Ba.flushImgs();p=A=Ba=null;Ca=Ca.imgData=null};this.isPaused=function(){return Ya};this.setContext=function(h){h!=A&&(A||!h||h.createImageData(1,1).data.buffer||(J=!1),A=h,null!=A&&(Ca.imgData=A.createImageData(a,b)))};this.getContext=function(){return A};this.resize=function(h,k){if(p.length!=k||p[0].length!=h){for(var g=0;g<k;g++)p[g]=new Uint32Array(h);
p.length=k;Ba.width=a=h;Ba.height=b=k;null!=A&&(Ca.imgData=A.createImageData(a,b))}};Ba.resize(a,b);this.getBuffer=function(){return p};this.setRGB=function(h,k,g){p[k][h]=g|4278190080};this.getRGB=function(h,k){return p[k][h]};this.setRGBs=function(h,k,g,n,q,t,x){var w=h+g,y=k+n;y>b&&(y=b);if(!(h>=a)){w>a&&(g-=w-a);for(w=k;w<y;w++,t+=x)p[w].set(q.subarray(t,t+g),h);c(h,k,g,n)}};this.moveArea=function(h,k,g,n,q,t){if(0<t){var x=h+q,w=k+t,y;for(y=n-1;0<=y;y--)p[w+y].set(p[k+y].subarray(h,h+g),x)}else if(0>
t)for(x=h+q,w=k+t,y=0;y<n;y++)p[w+y].set(p[k+y].subarray(h,h+g),x);else if(0<q){x=h+q;w=k+t;var G;for(y=g-1;0<=y;y--){var C=x+y;var M=h+y;for(G=0;G<n;G++)p[w+G][C]=p[k+G][M]}}else for(x=h+q,w=k+t,y=0;y<g;y++)for(C=x+y,M=h+y,G=0;G<n;G++)p[w+G][C]=p[k+G][M];c(h+q,k+t,g,n)};this.getRGBs=function(h,k,g,n,q){var t=new Uint32Array(g*n),x=h+g;n=k+n;for(var w=0;k<n;k++)t.set(p[k].subarray(h,x),w),w+=g;q(t)};this.repaint=function(h,k,g,n){var q=Ca.imgData.data,t=0,x,w;H&&H.begin("paint");0>h&&(g+=h,h=0);0>
k&&(n+=k,k=0);h+g>a&&(g=a-h);k+n>b&&(n=b-k);var y=h+g;var G=k+n;if(J)for(q=new Uint32Array(q.buffer),w=k;w<G;w++)q.set(p[w].subarray(h,y),t),t+=a;else{var C=4*(a-g)|0;for(w=k;w<G;w++){for(x=h;x<y;x++){var M=p[w][x];q[t++]=M&255;q[t++]=M>>8&255;q[t++]=M>>16&255;q[t++]=255}t+=C}}Ca.left=h;Ca.top=k;Ca.width=g;Ca.height=n;H&&H.end("paint");return Ca};this.postPaint=c;this.draw=function(h,k,g,n){if(A&&!Ya)if(Y&&Y.complete&&(A.drawImage(Y,R,T,ja,na),URL.revokeObjectURL(Y.src),Y=null),Fa){if(h=e(h,k,g,n),
h.width)return Ba.repaint(h.x,h.y,h.width,h.height),h.width=0,Ca}else if(r.width)return Ba.repaint(r.x,r.y,r.width,r.height),r.width=0,Ca;return null};this.fillRect=function(h,k,g,n,q){var t=h+g,x=k+n;if(p[0].fill)for(var w,y=k;y<x;y++)p[y].fill(q,h,t);else for(y=k;y<x;y++)for(w=h;w<t;w++)p[y][w]=q;c(h,k,g,n)};this.drawLine=function(h,k,g,n,q){if(k==n){if(h>g){var t=h;h=g;g=t}var x=p[k];g++;if(x.fill)x.fill(q,h,g);else for(t=h;t<g;t++)x[t]=q}else if(h==g)for(k>n&&(t=k,k=n,n=t),n++,t=k;t<n;t++)p[t][h]=
q;else{var w=Math.abs(g-h),y=Math.abs(n-k);t=h;x=k;g=g>=h?h=1:h=-1;k=n>=k?n=1:n=-1;if(w>=y){k=h=0;var G=w;var C=w/2|0;var M=y}else n=g=0,G=y,C=y/2|0,M=w,w=y;if(!(1>w))for(w++,y=0;y<w;y++)p[x][t]=q,C+=M,C>=G&&(C-=G,t+=h,x+=n),t+=g,x+=k}};this.bitBlt=function(h,k,g,n,q,t,x,w,y,G){var C=Ba;switch(h){case 0:w=C.setRGB;for(C=g;C<g+q;C++)for(y=n;y<n+t;y++)w(C,y,0);break;case 1:h=x;y=G*w+y;G=C.setRGB;k=C.getRGB;null==h&&(h=C);for(C=0;C<t;C++){for(x=0;x<q;x++)G(g+q,n+t,~(k(g+q,n+t)|h[y])&16777215);y+=w-q}break;
case 2:h=x;y=G*w+y;G=C.setRGB;k=C.getRGB;null==h&&(h=C);for(C=0;C<t;C++){for(x=0;x<q;x++){var M=k(g+q,n+t);G(g+q,n+t,M&~h[y]&16777215);y++}y+=w-q}break;case 3:m(C,x,w,y,G,q,t);x?C.setRGBs(g,n,q,t,x,G*w+y,w):C.moveArea(y,G,q,t,g-y,n-G);break;case 4:m(C,null,k,g,n,q,t);f(C,k,g,n,q,t,x,w,y,G);break;case 5:m(C,null,k,g,n,q,t);break;case 6:h=x;y=G*w+y;null==h&&(h=C);for(C=0;C<t;C++){for(G=0;G<q;G++)p[n+C][g+G]=p[n+C][g+G]^h[y]&16777215|4278190080,y++;y+=w-q}break;case 7:h=x;y=G*w+y;G=C.setRGB;k=C.getRGB;
null==h&&(h=C);for(C=0;C<t;C++){for(x=0;x<q;x++)M=k(g+x,n+C),G(g+x,n+C,~(M&h[y])&16777215),y++;y+=w-q}break;case 8:f(C,k,g,n,q,t,x,w,y,G);break;case 9:h=x;y=G*w+y;G=C.setRGB;k=C.getRGB;null==h&&(h=C);for(C=0;C<t;C++){for(x=0;x<q;x++)M=k(g+x,n+C),G(g+x,n+C,M^~h[y]&16777215),y++;y+=w-q}break;case 10:break;case 11:h=x;y=G*w+y;G=C.setRGB;k=C.getRGB;null==h&&(h=C);for(C=0;C<t;C++){for(x=0;x<q;x++)M=k(g+x,n+C),G(g+x,n+C,M|~h[y]&16777215),y++;y+=w-q}break;case 12:x?C.setRGBs(g,n,q,t,x,G*w+y,w):C.moveArea(y,
G,q,t,g-y,n-G);break;case 13:m(C,null,k,g,n,q,t);B(C,k,g,n,q,t,x,w,y,G);break;case 14:B(C,k,g,n,q,t,x,w,y,G);break;case 15:w=C.setRGB;for(C=g;C<g+q;C++)for(y=n;y<n+t;y++)w(C,y,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+h)}c(g,n,q,t)};this.drawLineExt=function(h,k,g,n,q,t){if(h==g||k==n){var x;if(k==n)if(g>h){var w=g-h;if(!(1>w))for(x=0;x<w;x++)D(t,h+x,k,q)}else{if(w=h-g,!(1>w))for(x=0;x<w;x++)D(t,g+x,k,q)}else if(n>k){if(w=n-k,!(1>w))for(x=0;x<w;x++)D(t,h,k+x,q)}else if(w=
k-n,!(1>w))for(x=0;x<w;x++)D(t,h,n+x,q)}else{var y=Math.abs(g-h),G=Math.abs(n-k);x=h;w=k;var C,M;var ma=g>=h?C=1:C=-1;var ca=n>=k?M=1:M=-1;if(y>=G){ca=C=0;var aa=y;var la=y/2>>0;var Da=G}else M=ma=0,aa=G,la=G/2>>0,Da=y,y=G;if(1>y)return;for(G=0;G<=y;G++)D(t,x,w,q),la+=Da,la>=aa&&(la-=aa,x+=C,w+=M),x+=ma,w+=ca}q=Math.min(h,g);h=Math.max(h,g);g=Math.min(k,n);k=Math.max(k,n);0>h-q||0>k-g||c(q,g,h-q+1,k-g+1)};this.drawText=function(h,k,g,n,q,t,x,w,y,G,C,M,ma,ca,aa,la,Da,yb,zb,Ab,Bb){var Ha=0;1<M?F(G,
C,M,ma,q,yb,zb,Ab,Bb):1==g&&F(t,x,w,y,q,yb,zb,Ab,Bb);for(var Rc=la,va=0;va<la;)switch(Da[Ha+va]){case 255:var Aa=Da[Ha+va+2];if(Aa>Rc-Ha){va=la=0;break}Aa=Da.slice?Da.slice(Ha,Ha+Aa):Da.subarray(Ha,Ha+Aa);Na[Da[Ha+va+1]]=Aa;va+=3;la-=va;Ha=va;va=0;break;case 254:var Va=(Aa=Na[Da[Ha+va+1]])?Aa:null;Va&&0==Va[1]&&0==(k&32)&&(0!=(k&4)?aa+=Da[Ha+va+2]:ca+=Da[Ha+va+2]);va=va+2<la?va+3:va+2;la-=va;Ha=va;va=0;if(!Va)break;for(var Sc=Va.length,Za=0;Za<Sc;Za++){Aa=Ia.getFont(h,Va[Za]);if(0==(k&32)){var hb=
Va[++Za];0!=(hb&128)?(0!=(k&4)?aa+=Va[Za+1]|Va[Za+2]<<8:ca+=Va[Za+1]|Va[Za+2]<<8,Za+=2):0!=(k&4)?aa+=hb:ca+=hb}Aa&&(S(g,ca+Aa.offset&65535,aa+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,q,n,yb,zb,Ab,Bb),0!=(k&32)&&(ca+=Aa.width))}break;default:Aa=Ia.getFont(h,Da[Ha+va]),0==(k&32)&&(hb=Da[Ha+ ++va],0!=(hb&128)?(0!=(k&4)?aa+=Da[Ha+va+1]|Da[Ha+va+2]<<8:ca+=Da[Ha+va+1]|Da[Ha+va+2]<<8,va+=2):0!=(k&4)?aa+=hb:ca+=hb),Aa&&(S(g,ca+Aa.offset&65535,aa+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,q,
n,yb,zb,Ab,Bb),0!=(k&32)&&(ca+=Aa.width)),va++}1<M?0<ma&&c(G,C,M,ma):0<w&&0<y&&c(t,x,w,y)};this.drawBitmap=function(h,k,g,n,q,t,x,w,y){var G=La.getBitmap(h,k);G?(h=G.width,k=G.height,q>h&&(q=h),t>k&&(t=k),12==y?Ba.setRGBs(g,n,q,t,G.data,w*h+x,h):Ba.bitBlt(y,a,g,n,q,t,G.data,h,x,w)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+h+" idx="+k)};this.saveDesktop=function(h,k,g,n,q){Ba.getRGBs(h,k,g,n,function(t){ra.save(h,k,g,n,q,t)})};this.restoreDesktop=function(h,k,g,n,q){(q=ra.restore(h,
k,g,n,q))?Ba.setRGBs(h,k,g,n,q,0,g):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(h,k,g){Ia.putFont(h,k,g)};this.putBitmap=function(h,k,g){La.putBitmap(h,k,g)};this.putCursor=function(h,k){da.set(h,k)};this.setCursor=function(h){if(!Ya&&-1!=h){var k=da.get(h);if(k)Ba.onSetCursor(k);else svGlobal.logger.warn("invalid cursor"+h)}};var X=0;this.isSendingHistory=function(){return 2E3>Date.now()-X};this.getHistory=function(h,k){var g=null;H&&H.begin("his_bitmap");La.forEach(function(w,
y,G){if(w){var C=0,M=0;G=0;for(var ma=w.length;G<ma;G++)w[G]&&w[G].data&&(C++,M+=w[G].raw?w[G].raw.length:4*w[G].data.length);if(C&&M){g=new Uint8Array(M+20*C+8);g[0]=29;g[2]=1;g[3]=4;M=new hi5.DataBuffer(g,4,g.length);M.setLittleEndian32(C);for(G=0;G<ma;G++)(C=w[G])&&C.data&&(M.setLittleEndian16(y),M.setLittleEndian16(G),M.setLittleEndian16(C.left),M.setLittleEndian16(C.top),M.setLittleEndian16(C.width),M.setLittleEndian16(C.height),M.setLittleEndian16(C.bitsperpixel),M.setLittleEndian16(C.codec),
M.setLittleEndian32(C.raw?C.raw.length:4*C.data.length),M.setBytes(C.raw||new Uint8Array(C.data.buffer)));h(g.buffer)}}});H&&H.end("his_bitmap");H&&H.begin("his_font");(g=Ia.toPDU())&&h(g.buffer);H&&H.end("his_font");(g=da.toPDU())&&h(g.buffer);for(var n=4,q=0,t=Na.length;q<t;q++)Na[q]&&(n+=Na[q].length+6);if(4<n){g=new Uint8Array(n);g[0]=29;g[2]=1;g[3]=7;var x=4;q=0;for(t=Na.length;q<t;q++)Na[q]&&Na[q].length&&(g[x++]=q,g[x++]=q>>8,n=Na[q].length,g[x++]=n,g[x++]=n>>8,g[x++]=n>>16,g[x++]=n>>24,g.set(Na[q],
x),x+=n);h(g.buffer)}(g=ra.toPDU())&&h(g.buffer);k();X=Date.now()};this.setHistory=function(h,k){switch(h){case 4:H&&H.begin("his_bitmap_dec");var g=k.getLittleEndian32();for(h=0;h<g;h++){var n=k.getLittleEndian16(),q=k.getLittleEndian16(),t=k.getLittleEndian16(),x=k.getLittleEndian16(),w=k.getLittleEndian16(),y=k.getLittleEndian16(),G=k.getLittleEndian16(),C=k.getLittleEndian16(),M=k.getLittleEndian32(),ma=new Uint8Array(k.getData().buffer,k.getPosition(),M),ca=new Uint8Array(M);ca.set(ma);ma=rdpcodecs.bitmap;
switch(C){case 0:var aa=new Uint32Array(ca.buffer);k.skipPosition(M);break;case 1:switch(G){case 16:aa=ma.decompressInt16(w,y,M,ca,0);break;case 24:aa=ma.decompressInt24(w,y,M,ca,0);break;case 32:aa=ma.decompressInt32(w,y,M,ca,0)}k.skipPosition(M);break;case 2:aa=new rdpcodecs.NSCodec,aa.process(k,G,w,y),M=aa.getData(),aa=aa.getDataSize(),aa=new Uint32Array(aa),rdpcodecs.flipimage(M,0,aa,w,y,1)}La.putBitmap(n,q,new rdpcodecs.Bitmap(aa,w,y,t,x,G,0==C?null:ca,C))}H&&H.end("his_bitmap_dec");break;case 5:Ia.fromStream(k);
break;case 6:da.fromStream(k);break;case 7:for(;k.has(6);)if(h=k.getLittleEndian16(),M=k.getLittleEndian32())g=k.getData().subarray(k.getPosition(),k.getPosition()+M),Na[h]=g,k.skipPosition(M);break;case 9:ra.fromStream(k)}};var da=new function(){var h=[],k=!1;this.useRemoteCursor=function(g){k=g};this.set=function(g,n){k&&(n.system="");h[g]=n};this.get=function(g){return h[g]};this.total=function(){return h.length};this.toPDU=function(){for(var g=2,n=2,q=0,t=0,x=h.length,w;t<x;t++)if(w=h[t])q++,
n=n+7+(w.rawData?w.rawData.length:0);if(!q)return null;n=new Uint32Array(n);n[0]=100728861;n[1]=q;for(t=0;t<x;t++)if(w=h[t])if(q=w.rawData?w.rawData.length:0,n[g++]=w.cache_idx|w.bpp<<16,n[g++]=w.hotX|w.hotY<<16,n[g++]=w.width|w.height<<16,n[g++]=w.xorSize,n[g++]=w.andSize,n[g++]=w.distance,n[g++]=q)n.set(w.rawData,g),g+=q;return n};this.fromStream=function(g){var n=g.getPosition();g=new Uint32Array(g.getData().buffer,n);var q=g[0],t=0;for(n=1;t<q;t++){var x=g[n]&65535;var w=g[n++]>>16;var y=g[n]&
65535;var G=g[n++]>>16;var C=g[n]&65535;var M=g[n++]>>16;var ma=g[n++];var ca=g[n++];var aa=g[n++];var la=g[n++];var Da=null;la&&(Da=new Uint32Array(la),Da.set(g.subarray(n,n+la)),n+=la);w=new u(x,Da,y,G,C,M,w,ma,ca);aa&&(w.distance=aa);k&&(w.system="");h[x]=w}}};da.useRemoteCursor(!!K.remoteCursor);var ra=new function(){function h(g,n,q,t,x,w){this.x=g;this.y=n;this.cx=q;this.cy=t;this.offset=x;this.data=w}var k=[];this.save=function(g,n,q,t,x,w){g=new h(g,n,q,t,x,w);n=0;for(q=k.length;n<q;n++)if(!k[n]){k[n]=
g;return}k.push(g)};this.restore=function(g,n,q,t,x){for(var w,y=0,G=k.length;y<G;y++)if((w=k[y])&&w.x==g&&w.y==n&&w.cx==q&&w.cy==t){if(w.offset==x)return g=w.data,k[y]=null,g;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var g=0,n=2,q=0,t=k.length;q<t;q++)k[q]&&(g++,n+=k[q].data.length+6);if(!g||!n)return null;n=new Uint32Array(n);var x=2;n[0]=151060509;n[1]=g;for(q=0;q<t;q++)if(g=k[q])n[x++]=g.x,n[x++]=g.y,n[x++]=g.cx,n[x++]=g.cy,n[x++]=g.offset,n[x++]=g.data.length,
n.set(g.data,x),x+=g.data.length;return n};this.fromStream=function(g){g=new Uint32Array(g.getData().buffer,g.getPosition());for(var n=1,q=g[0],t,x,w,y,G,C,M,ma=0;ma<q;ma++)t=g[n++],x=g[n++],w=g[n++],y=g[n++],G=g[n++],C=g[n++],M=new Uint32Array(C),C=n+C,M.set(g.subarray(n,C)),n=C,this.save(t,x,w,y,G,M)}},Na=[],Ia=new function(){var h=[];this.putFont=function(k,g,n){h[k]||(h[k]=[]);h[k][g]=n};this.getFont=function(k,g){return h[k]?h[k][g]:null};this.toPDU=function(){var k=0,g,n,q;var t=4;for(var x,
w=h.length;k<w;k++)if((q=h[k])&&q.length)for(x=q.length,g=0;g<x;g++)(n=q[g])&&(t+=15+n.fontData.length);if(5>t)return null;var y=new Uint8Array(t);t=new hi5.DataBuffer(y,0,t);y[0]=29;y[2]=1;y[3]=5;t.skipPosition(4);k=0;for(w=h.length;k<w;k++)if((q=h[k])&&q.length)for(x=q.length,g=0;g<x;g++)if(n=q[g])t.setByte(k),t.setLittleEndian16(g),t.setLittleEndian16(n.offset),t.setLittleEndian16(n.baseLine),t.setLittleEndian16(n.width),t.setLittleEndian16(n.height),t.setLittleEndian32(n.fontData.length),t.setBytes(n.fontData);
return y};this.fromStream=function(k){for(;k.has(15);){var g=k.getByte(),n=k.getLittleEndian16(),q=k.getLittleEndian16(),t=k.getLittleEndian16(),x=k.getLittleEndian16(),w=k.getLittleEndian16(),y=k.getLittleEndian32();y=k.getBytes(y);this.putFont(g,n,new z(q,t,x,w,y))}}},La=new function(){var h=[],k=[];this.putBitmap=function(g,n,q){if(32767==n)k[g]&&(k[g].data=null,k[g]=null),k[g]=q;else{var t=h[g];t?t[n]&&(t[n].data=null,t[n]=null):h[g]=t=[];t[n]=q}};this.getBitmap=function(g,n){return 32767==n?
k[g]:h[g]?h[g][n]:null};this.forEach=function(g){for(var n=h.length,q=0;q<n;q++)g(h[q],q,h)}}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var xb=!1,bb={},cb={},pb=null,l=this,Ub=!1,Ka=!1,Ra=0,qb=null,rb=null,tc=0;hi5.appcfg||(hi5.appcfg={img:{},
toolbar:{fadable:!0},displayMsg:!0});var K=hi5.appcfg,vb="";this.setConfig=function(a){K=a};var Qa="object"==typeof v?v:null,E=Qa?{}:hi5.tool.queryToObj(v.substring(v.indexOf("?")+1)),pa=0,qa=0,ab=(U||E.color||E.server_bpp||16)|0,kb=null,uc=null,wa=null,ub=null,vc="/DOWNLOAD?",wc="/CLIP?";24==ab&&(ab=16);this.setLinks=function(a){a.download&&(vc=a.download);a.clipboard&&(wc=a.clipboard)};this.protocol=Qa?"":v.substring(0,v.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return Z(E.smartCard)||
Z(E.mapSmartCard)||Z(E.passwordIsPin)};this.hasScanner=function(){return Z(E.scanner)};this.hasUSB=function(){return Z(E.mapUSB)&&!!navigator.usb};this.getUSB=function(){return E.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){uc=a};this.getProfiler=function(){return uc};this.gateway=function(){if(Qa)return"";var a=v.lastIndexOf("/RDP?");
-1==a&&(a=v.lastIndexOf("/JOIN?"));-1==a&&(a=v.lastIndexOf("/PLAY?"));return v.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=Pa;var Xa="object"==typeof v||0<v.indexOf("/PLAY?"),xc=!Xa&&0<v.indexOf("invitation=");if(xc){var Yb=decodeURIComponent(v),Cb=Yb.indexOf(' USERNAME="');if(0<Cb){Cb+=11;var yc=Yb.substring(Cb,Yb.indexOf('"',Cb));v+="&novice="+yc+"&server="+yc}v+="&mapClipboard=on";
E.mapClipboard="on";this.reconnectOnResize=!1}if(Xa)this.mode=1,Qa?v="":(pa=640,qa=480),v+="&touchpad=on",E.touchpad="on",this.reconnectOnResize=!1;else if(0<v.indexOf("/JOIN?")||xc)this.mode=2,this.reconnectOnResize=!1;L?pa=parseInt(L):E.width&&(pa=parseInt(E.width));P?qa=parseInt(P):E.height&&(qa=parseInt(E.height));-1==pa&&(pa=hi5.browser.getScreenWidth());-1==qa&&(qa=hi5.browser.getScreenHeight());E.symlink&&E.parameters&&hi5.tool.queryToObj(E.parameters,E);E.gateway||(v+="&gateway="+encodeURIComponent(l.gateway));
!E.minWidth&&K.minWidth&&(E.minWidth=K.minWidth);!E.minHeight&&K.minHeight&&(E.minHeight=K.minHeight);E.minWidth&&(E.minWidth=parseInt(E.minWidth));E.minHeight&&(E.minHeight=parseInt(E.minHeight));E.waWidth=E.waWidth?parseInt(E.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;E.waWidth&=-4;E.waHeight=E.waHeight?parseInt(E.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;E.waHeight&=-4;"useSSL"in
E||(v+="&useSSL="+("wss"==l.protocol));hi5.storage.isAvailable&&(Z(E.shareClipboard)||E.shareClipboardId)&&(v+="&shareClipboardId="+(E.shareClipboardId||O()));K&&(void 0!=K.displayMsg?this.displayMsg=K.displayMsg:K.displayMsg=this.displayMsg,K.appTimeout&&(this.appTimeout=K.appTimeout),void 0!=K.reconnectOnResize&&(this.reconnectOnResize=K.reconnectOnResize),K.reconnectTimes&&(this.reconnectTimes=K.reconnectTimes),void 0!=K.windowState&&(this.windowState=K.windowState),void 0!=K.openLink&&(this.openLink=
K.openLink),void 0!=K.setTitle&&(this.setTitle=K.setTitle),K.audioBuffer&&(this.audioBuffer=K.audioBuffer),"boolean"==typeof K.useWSS&&(v=(K.useWSS?"wss":"ws")+v.substring(v.indexOf("://"))),"boolean"==typeof K.remoteAppLogin&&(this.remoteAppLogin=K.remoteAppLogin,xb=!K.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof K.hideLogin&&(xb=K.hideLogin),void 0!=K.localPrinter&&void 0==E.localPrinter&&(E.localPrinter=K.localPrinter));
Z(E.nocurosr);var Ja="app"==E.startProgram,wb=Z(E.mapDisk),eb=0,ta=null;void 0==K.useWorker&&(K.useWorker=!1);K.useWorker&&(!window.Worker||hi5.browser.isFirefox||Ja&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(K.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var sa=K.useWorker?new Worker(N("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,jb=this.reconnectTimes,Hb=sa?{type:5,data:null}:null;this.getDisplayName=Q;this.server=Q();this.port=
parseInt(E.port,10);this.loadbalanceToken="";K.loadbalanceTokenName&&(E[K.loadbalanceTokenName]?ha(E[K.loadbalanceTokenName]):!1!==K.randomAppId?ha(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){l.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+l.loadbalanceToken:"&"+l.loadbalanceToken,a+="&loadbalanceTokenName="+K.loadbalanceTokenName);return a};this.getURL=function(){return v};this.getColor=function(){return ab};this.changeTitle=Ua;hi5.browser.isTouch&&
Math.max(pa,qa)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Ja};var fa=null,oa=!1,gb=!1,Xb=!1,ua=new function(a){var b=null;this.available=!1;this.delay=a;this.supportWebAudio=!1;(0==E.playSound||0<l.mode)&&(b=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return b};this.getBuffer=function(m){return b.createBuffer(2,m,Wa)};var d=0,e=null,c=null;this.setVolume=function(m){1==
m?e=null:(e||(e=b.createGain()),e.gain.value=m)};this.playBuffer=function(m){c=b.createBufferSource();c.buffer=m;e?(c.connect(e),e.connect(b.destination)):c.connect(b.destination);var f=b.currentTime,B=0<d?d:f+a;B<f&&(B=f);d=B+m.duration;c.start?c.start(B):c.noteOn(B);return d-f};this.iOSFix=function(){if(b&&hi5.browser.isSafari){var m=this.getBuffer(1024),f=b.createBufferSource();f.buffer=m;f.connect(b.destination);f.start?f.start(0):f.noteOn(0)}};this.close=function(){b&&(e&&e.disconnect(),c&&c.disconnect(),
hi5.audio.releaseAudioContext())}}(l.audioBuffer),gc=ua.available,W=new Zb(200,200);W.onSetCursor=hc;this.setVolume=function(a){ua&&ua.setVolume(a)};this.setAudioBuffer=function(a){l.audioBuffer=a;ua.delay=a};var Eb=0,Db=0,Fb=pa-1,Gb=qa-1,Vb="";window.$rdp||(window.$rdp=this);nb(ab);this.running=function(){return oa};this.setJoinMode=function(a){oa&&ba("8E1"+a)};this.setJoinCloseMode=function(a){oa&&ba("8EB3\t"+a)};this.refuseControl=function(a){oa&&ba("8E3"+a)};this.giveControl=function(a){oa&&ba("8E4"+
a)};this.pauseSession=function(a,b){oa&&ba("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){oa&&ba("8EB2\t"+a)};this.requestControl=function(){oa&&ba("8E2")};this.saveSession=function(a){oa&&ba("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){oa&&ba("8EA"+a+"\t"+(b?1:0))};var sb=new function(){function a(){if(d&&0<d.length){var m=d.shift();m.key?sb.sendSingleKey(m.down,m.key):m.char&&$b(m.char);0<d.length?setTimeout(a,e):(d=null,c&&c())}}var b={" ":57,space:57,
pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(m,f){var B=b[f.toLowerCase()];B?l.writeScancode(m,B):(B=f.length,0!=B&&(1==
B?l.writeKeyCode(m,f.toUpperCase().charCodeAt(0)):m&&l.writeText(f)))};var d=null,e=0,c=null;this.sendKeyComb=function(m,f,B){if(Ka){m=m.split("+");var D=m.length,F;if(0!=D){var S=null,z=[];for(F=0;F<D;F++){var u=m[F];""==u&&""==S&&(u="Add");""!=u&&z.push({key:u,down:!0});S=u}D=z.length;for(F=D-1;0<=F;F--)z.push({key:z[F].key,down:!1});if(f)d=z,e=f,c=B,a();else for(F=0,D=z.length;F<D;F++)sb.sendSingleKey(z[F].down,z[F].key)}}};this.sendText=function(m,f,B){for(var D=[],F=0,S=m.length;F<S;F++)D.push({"char":m.charAt(F)});
d=D;e=f;c=B;a()}};this.writeKeyComb=function(a,b,d){Ka&&sb.sendKeyComb(a,b,d)};this.writeText=function(a,b,d){if(Ka)if(b)sb.sendText(a,b,d);else for(b=0,d=a.length;b<d;b++)$b(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),l.writeRawInput("880"+b+"\t"+a.hashCode()),rb={type:b,text:a})};var I=new function(a,b){function d(){function c(z){for(;0<z.ownerWinid;){var u=F.getWinById(z.ownerWinid);if(u&&u.isVisible())z=u;else break}return z}function m(z){for(var u="";z;)z.titleInfo&&
(u=z.titleInfo),z=F.getWinById(z.ownerWinid);return u}var f=[],B=[],D=0,F=this;this.mainWin=null;this.appId="";var S=0;this.getActiveWinId=function(){return S};this.setActiveWinId=function(z){svGlobal.logger.info("setActiveWinId: "+z+" old: "+S);if(S!=z){var u=0==S;S=z;(z=F.getMainByWinId(z))&&z.isMainWin()&&F.mainWin!=z&&(F.mainWin=z);u&&(u=I.getFocused())&&(u=u.getFreeSpace(),z=u.width,l.resetSize(z,u.height))}};this.onchange=function(z){z.isVisible()||z!=F.mainWin?z.isVisible()&&!F.mainWin&&z.isMainWin()&&
(F.mainWin=z,a.windowState&&z.exeCommand(61488)):F.mainWin=null};this.addWin=function(z){for(var u=f.length,p=!1,A=0;A<u;A++)if(z.id==f[A].id){f[A]=z;p=!0;break}p||f.push(z);1==f.length&&(D=Date.now());u=z.isMainWin();svGlobal.logger.info("is main win:"+u+" id:"+z.id);u&&!F.mainWin&&(F.mainWin=z)};this.popWins=function(z){z=F.getWinById(z);var u=[];if(z){z=0<z.ownerWinid?z.ownerWinid:z.id;for(var p=f.length-1;0<=p;p--)if(f[p].ownerWinid==z||f[p].id==z)u.push(f[p]),f.splice(p,1)}return u};this.hasApp=
function(z){return-1!=B.indexOf(z)};this.addApp=function(z){return-1==B.indexOf(z)?(B.push(z),!0):!1};this.isNew=function(){return 3E4>Date.now()-D};this.getAll=function(){return f};this.hasWin=function(z){return 0<=f.indexOf(z)};this.close=function(){for(var z=0,u=f.length;z<u;z++)f[z].close()};this.clear=function(){f.length=0};this.delWin=function(z){for(var u=0,p=f.length;u<p;u++)if(f[u].id==z)return f.splice(u,1),u;return-1};this.isRunning=function(){var z=f.length;if(1>z)return!1;var u=0;for(z=
f.length;u<z;u++){var p=f[u];if(p.showState)return!0}return!1};this.getWinById=function(z){var u=f.length;if(1>u)return null;for(var p=0;p<u;p++){var A=f[p];if(A.id==z)return A}return null};this.getMainWinByAppId=function(z){var u=null,p=0;for(len=f.length;p<len;){u=f[p];if(u.appId==z&&u.isVisible()&&1>u.ownerWinid)break;p++}return u};this.getTopWin=function(z){var u=null,p,A=z.length;for(p=0;p<A&&(!(u=F.getWinById(z[p]))||!u.isVisible());p++)u=null;if(!u)for(svGlobal.logger.warn("No win found"),
A=f.length,p=A-1;0<=p&&(u=f[p],!u.isVisible());p--)u=null;return u};this.getMain=function(z){return(z=F.getTopWin(z))?c(z):null};this.getMainByWinId=function(z){return(z=F.getWinById(z))?c(z):null};this.getOtherApps=function(z,u,p){var A=f.length;if(0!=A&&f[A-1])if(A=f[A-1].appId,p||!A)setTimeout(function(){F.getOtherApps(z,u)},p||3E3);else{p=[];if(A=F.getTopWin(z)){var r=0<A.ownerWinid?A.ownerWinid:A.id,J=[],H=0;for(A=f.length;H<A;H++)f[H].ownerWinid!=r&&f[H].id!=r&&f[H].isVisible()&&J.push(f[H]);
H=0;for(A=J.length;H<A;H++)J[H].ownerWinid!=r&&J[H].id!=r&&(p.push({title:m(J[H]),win:c(J[H])}),r=0<J[H].ownerWinid?J[H].ownerWinid:J[H].id)}u(p)}};this.getFullTitle=function(z){for(var u,p="";;){u=F.getWinById(z);if(!u)break;u.titleInfo&&u.isVisible()&&(p&&(p=" > "+p),p=u.titleInfo+p);if(1>z)break;z=u.ownerWinid}return p}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var c=e.length,m=0;m<c;m++)e[m].railWin&&e[m].railWin.close()};this.verifyMonitors=function(){for(var c=e.length,
m=Array(c),f=0;f<c;f++)e[f].configMonitor(),m[f]=e[f].getMousePosition();m.sort(function(F,S){var z=F.left-S.left;return 0!=z?z:F.top-S.top});var B=m.findIndex(function(F){return 0==F.left&&0==F.top});svGlobal.logger.info("monitor layout",m,B);-1==B&&(l.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",m));for(f=B-1;0<=f;){if(m[f].right<m[f+1].left){var D=m[f+1].left-m[f].right-1;0<D&&(m[f].right+=
D,m[f].left+=D)}m[f].bottom<m[f+1].top&&(D=m[f+1].top-m[f].bottom-1,0<D&&(m[f].top+=D,m[f].bottom+=D));f--}for(f=B+1;f<c;)m[f-1].right<m[f].left&&(D=m[f].left-m[f-1].right-1,0<D&&(m[f].right-=D,m[f].left-=D)),m[f-1].bottom<m[f].top&&(D=m[f].top-m[f-1].bottom-1,0<D&&(m[f].top-=D,m[f].bottom-=D)),f++};this.repaint=function(c,m,f,B){for(var D=0,F=e.length;D<F;D++)e[D].repaint(c,m,f,B)};this.size=function(){return e.length};this.getSurface=function(c){return e[c]};this.addSurface=function(c){e.push(c)};
this.hasSurface=function(c){for(var m=e.length,f=0;f<m;f++)if(e[f].equals(c))return!0;return!1};this.fromSyncedSurface=function(c){var m=e.length;Date.now();for(var f=0;f<m;f++)if(e[f].isClipSynced(c))return!0;return!1};this.setSize=function(c,m,f){for(var B=0,D=e.length;B<D;B++)e[B].setSize(c,m,f)};this.zOrders=[];this.drawLicense=function(c){for(var m=0,f=e.length;m<f;m++)e[m].drawLicense(c)};this.setReadOnly=function(c,m){for(var f=0,B=e.length;f<B;f++)e[f].setReadOnly(c,m)};this.setVisible=function(c,
m){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(c){for(var m=0,f=e.length;m<f;m++)e[m]&&e[m].setCursor(c)};this.hide=function(c){c=0;for(var m=e.length;c<m;c++)e[c]&&e[c].hide()};this.execute=function(c,m){for(var f=0,B=e.length;f<B;f++)e[f][c].apply(e[f],m)};this.addWin=function(c){var m=this.getFocused();m||(svGlobal.logger.warn("Focused surface not found!"),m=e[e.length-1]);m?(Ja=!0,m.railWin||(m.railWin=new d,m.onunload=function(){hi5.appcfg.closeRemoteApp&&m.railWin&&m.railWin.close();
m.remoteApp&&m.remoteApp.close();m.railWin&&(m.railWin.clear(),m.railWin=null);e.removeElm(m)}),m.context&&b.setContext(m.context),m.railWin.addWin(c),m.railWin.mainWin==c&&(setTimeout(function(){var f=m.getFreeSpace();a.writeRawInput("8C661441\t"+f.width+"\t"+f.height);svGlobal.logger.info("-- main win dp change:"+f.height);a.windowState&&c.resizable()&&setTimeout(function(){c.exeCommand(61488);svGlobal.logger.info("-- max")},50)},111),xa.sendKeyboardSyncFlags(xa.localLockFlags,500)),hi5.browser.isIE&&
m.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(c){for(var m,f=e.length-1;0<=f;f--){var B=e[f];m=B.railWin;var D=m.getWinById(c),F=D&&D.appId&&-1!=D.appId.toLowerCase().indexOf("runonce");if(0<=m.delWin(c)){D==m.mainWin&&(m.mainWin=null);if(B.toolbar){c="win"+c;var S=B.toolbar.querySelector("#"+c);S&&B.toolbar.removeChild(S)}if(!m.isRunning()&&0==l.mode){if(D.isMainWin()&&B.onremoteappclose)B.onremoteappclose(D);D=a.appTimeout;if(F||m.isNew())D*=10;svGlobal.logger.debug("Prepare del:"+
Date.now());setTimeout(function(z){return function(){svGlobal.logger.info("Start del:"+Date.now());z.railWin&&z.railWin.isRunning()||(z.remoteApp&&z.remoteApp.close(),I&&I.delSurface(z))}}(B),D)}}}};this.popWins=function(c){return e[0]&&e[0].railWin?e[0].railWin.popWins(c):[]};this.getWinById=function(c){for(var m,f=0,B=e.length;f<B;f++)if(e[f].railWin&&(m=e[f].railWin.getWinById(c)))return m;return null};this.getMainWinByAppId=function(c){for(var m,f=0,B=e.length;f<B;f++)if(e[f].railWin&&(m=e[f].railWin.getMainWinByAppId(c)))return m;
return null};this.onWinChange=function(c){for(var m,f=0,B=e.length;f<B;f++)if(e[f].railWin&&(m=e[f].railWin.getWinById(c.id)))e[f].railWin.onchange(c)};this.setTitle=function(c){for(var m,f=0,B=e.length;f<B;f++)if(e[f].railWin){m=e[f].railWin.getWinById(c);var D=e[f].railWin.getFullTitle(c);if(D){a.changeTitle(D,e[f].getWindow(),m.appId);break}}};this.hasApp=function(c){for(var m=0,f=e.length;m<f;m++)if(e[m].railWin.hasApp(c))return!0;return!1};this.delSurface=function(c){!c||c.railWin&&c.railWin.isRunning()||
(svGlobal.logger.info("delete surface..."),e.removeElm(c),c.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(c){for(var m=0,f=e.length;m<f;m++)if(e[m].railWin&&e[m].railWin.hasWin(c))return e[m];return null};this.getOwnerSurfaceById=function(c){for(var m,f=0,B=e.length;f<B;f++)if(e[f].railWin&&(m=e[f].railWin.getWinById(c)))return e[f];return null};this.getFocused=function(){for(var c=e.length,m=0;m<c;m++)if(e[m].focused)return e[m];return e[c-1]};this.close=function(){for(var c=0,
m=e.length;c<m;c++)e[c]&&(e[c].remoteApp&&e[c].remoteApp.close(),e[c].close(),e[c]=null)};this.LocalWin=function(c){function m(){a.writeRawInput("8C0"+c)}this.id=c;this.appId="";var f=this;this.resizable=function(){return f.isVisible?0!=(f.style&262144)||0!=(f.style&65536)||0!=(f.style&16777216)||3==f.showState:!1};this.setShowState=function(B){f.showState=B};this.parent=function(){return I.getWinById(f.ownerWinid)};this.resize=function(B,D,F,S){hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+
f.id+"\t"+B+"\t"+D+"\t"+F+"\t"+S)};this.exeCommand=function(B){a.writeRawInput("8C4"+c+"\t"+B)};this.activate=function(B){2==f.showState?(f.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+c+"\t"+B)},50)):a.writeRawInput("8C3"+c+"\t"+B)};this.close=function(){f.exeCommand(61536)};this.getAppId=m;this.isVisible=function(){return f.winWidth&&f.winHeight&&f.showState&&45<f.winHeight&&45<f.winWidth};this.isMainWin=function(){if(!(f.isVisible()&&f.winWidth&&f.winHeight&&45<f.winHeight&&45<
f.winWidth))return!1;var B=1>f.ownerWinid;if(!B)return B;var D=f.style;if(0!=(D&4194304))return!0;if(0!=(D&2147483648)&&(0==(D&8388608)||0==(D&12582912)))return!1;var F=0!=(f.extStyle&128);(B=B&&!F)&&0!=(D&2147483648)&&0==(D&2156396544)&&(B=!1);return B};m()}}(l,W);this.getSurfaces=function(){return I};this.hide=function(){I&&I.hide()};this.getFileUrl=function(a,b,d){var e=Pa(),c=vc,m=c.indexOf("://");e=(0<m&&11>m?c:e+c)+"s="+Vb+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);d&&(e+="&action="+d);return l.modifyURL(e)};
this.listFiles=function(a,b){ta&&Ka&&ta.list(a,b)};this.writeRawInput=function(a){if(Ka){ba(a);if(l.onactivity)l.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var d=a.length,e=new Uint8Array(5+d);e[0]=146;e[1]=7;e[2]=b;e[3]=d&255;e[4]=d>>8&255;for(b=0;b<d;b++)e[5+b]=a.charCodeAt(b);ba(e.buffer)};var zc=0;if(K.numLock||K.numlock||Z(E.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)zc|=2;var xa=new function(a,b,d,e){this.setJoinMode=a.setJoinMode;this.requestControl=
a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=e||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;this.draw=d.draw;var c=a.isRemoteApp(),m=void 0;this.saveResize=function(f){m=a.reconnectOnResize;a.reconnectOnResize=f};this.restoreResize=function(){void 0!=m&&(a.reconnectOnResize=m)};this.refresh=function(f,B,D,F){return d.repaint(f,B,D-f+1,F-B+1)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};
this.send=a.writeRawInput;this.saveSession=function(f){a.saveSession(f)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumeAudio=function(){ua.supportWebAudio&&ua.iOSFix()};this.onresize=function(f){if(f=f.target.svSurface){var B=f.getFreeSpace(),D=B.width;B=B.height;xa.checkLockFlags=!0;K.scale?f.scaleTo(D,B,!1):a.resetSize(D,B)}};this.onorientationchange=function(f){a.resetSize(f.innerWidth,f.innerHeight)};this.getClipData=function(f,B){this.reqCopyTime=
Date.now();var D=a.getGatewayAddr(),F=wc,S=F.indexOf("://");D=(0<S&&11>S?F:D+F)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+f;f=hi5.httpGet(a.modifyURL(D),B);this.reqCopyTime=Date.now();qc(f);return f};this.onfocus=function(f){var B=I.getFocused();c&&B&&B.railWin&&(f=B.railWin.mainWin)&&a.running()&&(B=B.context)&&B!=d.getContext()&&(d.setContext(null),f.activate(1),svGlobal.logger.info("Activate win:"+f.id))};this.getShareFiles=a.listFiles;this.getFile=function(f,B,D){a.reconnectOnResize=
!1;var F=a.getFileUrl(f,B,D);l.ondownload&&l.ondownload({fileName:f,url:F,source:B,action:D})||window.open(F)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return v};this.reconnect=function(f,B,D){E.symlink?(f="user="+f+"&pwd="+B,D&&(f+="&domain="+D),v=hi5.tool.replaceQuery(v,"parameters",f)):(v=hi5.tool.replaceQuery(v,"user",f),v=hi5.tool.replaceQuery(v,"pwd",B),v=hi5.tool.replaceQuery(v,"domain",D));a.run()};this.sendKeyboardSyncFlags=function(f,B){return Ka?(svGlobal.logger.info("sync lock keys, current:"+
f+" was:"+this.localLockFlags+" remote:"+this.remoteLockFlags),this.remoteLockFlags=this.localLockFlags=f,setTimeout(function(){a.writeRawInput("8E5"+f)},B||333),!0):!1};this.sendKeyboardSynchronize=function(f,B,D){var F=0;D&&(F|=4);B&&(F|=2);f&&(F|=1);this.sendKeyboardSyncFlags(F)};this.fromSyncedSurface=function(f){return b.fromSyncedSurface(f)};this.setWorkDir=function(f){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(f,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,
28)})},666)})};this.authWithCode=function(f,B){a.authWithCode(f,B)};this.getPrinters=function(f){a.getPrinters(f)};this.attachPrinter=function(f){a.attachPrinter(f)}}(l,I,W,zc);this.sendKeyboardSynchronize=function(a,b,d){xa.sendKeyboardSynchronize(a,b,d)};this.VirtualChannel=function(){return new Ib(143)};this.GatewayChannel=function(){return new Ib(28)};this.DynamicChannel=function(){return new Ib(64)};this.addChannel=function(a){bb[a.name]=a};this.addGatewayChannel=function(a){cb[a.name]=a};this.addDynamicChannel=
function(a){ia.names.push(a.name);ia[a.name]=a;ia.count++};var ya=null,ia={count:0,names:[],usbChannel:null,close:function(){for(var a=ia.names,b=0,d=a.length;b<d;b++)ia[a[b]].onclose&&(ia[a[b]].onclose(),ia[a[b]]=null);a.length=0;ia.usbChannel=null},init:function(a,b,d,e,c,m){function f(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=
this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var u=this;this.fromBuffer=function(p,A){u.formatTag=p.getLittleEndian16();u.nChannels=p.getLittleEndian16();u.nSamplesPerSec=p.getLittleEndian32();u.nAvgBytesPerSec=p.getLittleEndian32();u.nBlockAlign=p.getLittleEndian16();u.bitsPerSample=p.getLittleEndian16();var r=p.getLittleEndian16();u.cbSize=r;0<r&&!0!==A&&(u.extenstion=Array(r),p.copyToByteArray(u.extenstion,0,p.getPosition(),r),p.skipPosition(r))};
this.toBuffer=function(p){p.setLittleEndian16(u.formatTag);p.setLittleEndian16(u.nChannels);p.setLittleEndian32(u.nSamplesPerSec);p.setLittleEndian32(u.nAvgBytesPerSec);p.setLittleEndian16(u.nBlockAlign);p.setLittleEndian16(u.bitsPerSample);p.setLittleEndian16(u.cbSize);0<u.cbSize&&p.setBytes(u.extenstion)};this.getSize=function(){return 18+u.cbSize};this.toString=function(){return"Audio Format, tag="+u.formatTag+" nChannels="+u.nChannels+" nSamplesPerSec="+u.nSamplesPerSec+" nAvgBytesPerSec="+u.nAvgBytesPerSec+
" nBlockAlign="+u.nBlockAlign+" bitsPerSample="+u.bitsPerSample+" cbSize="+u.cbSize}}function B(){ya=new l.DynamicChannel;ya.name="Microsoft::Windows::RDS::DisplayControl";ya.enabled=!1;ya.process=function(u){var p=u.getLittleEndian32();u.getLittleEndian32();switch(p){case 5:p=u.getLittleEndian32(),ya.maxMonitorAreaFactorA=u.getLittleEndian32(),ya.maxMonitorAreaFactorB=u.getLittleEndian32(),ya.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+p+" factorA:"+ya.maxMonitorAreaFactorA+
" factorB:"+ya.maxMonitorAreaFactorB),u=new Uint8Array(2),u[0]=146,u[1]=4,ba(u.buffer),wa&&setTimeout(function(){wa&&wa.check(5E3)},1900)}};ya.applyResolution=function(u,p){if(ya.enabled){var A=new Uint8Array(56),r=new RdpBuffer(A,0,56);u=u>ya.maxMonitorAreaFactorA?ya.maxMonitorAreaFactorA:u&-4;p=p>ya.maxMonitorAreaFactorB?ya.maxMonitorAreaFactorB:p&-4;r.setLittleEndian32(2);r.setLittleEndian32(56);r.setLittleEndian32(40);r.setLittleEndian32(1);r.setLittleEndian32(1);r.setLittleEndian32(0);r.setLittleEndian32(0);
r.setLittleEndian32(u);r.setLittleEndian32(p);r.setLittleEndian32(.26458*u|0);r.setLittleEndian32(.26458*p|0);r.setLittleEndian32(u>p?0:90);r.setLittleEndian32(100);r.setLittleEndian32(100);ya.send(A);svGlobal.logger.warn("Display control: "+u+"x"+p)}else svGlobal.logger.warn("Display control disabled.")};return ya}if(!K.disableDVC){if(K.enableEcho){var D=new l.DynamicChannel;D.name="ECHO";D.process=function(u){var p=u.getPosition(),A=u.getEnd(),r=new Uint8Array(A-p);r.set(u.getData().subarray(p,
A));D.send(r)};l.addDynamicChannel(D)}if(a){var F=new l.DynamicChannel;F.name="Microsoft::Windows::RDS::Input";F.process=function(u){var p=u.getLittleEndian16();u.getLittleEndian32();switch(p){case 1:u.skipPosition(4),u=new RdpBuffer(new Uint8Array(16),0,16),u.setLittleEndian16(2),u.setLittleEndian32(16),u.setLittleEndian32(3),u.setLittleEndian32(65536),u.setLittleEndian16(256),u.markEnd(),F.send(u);case 5:I.execute("setTouchRemoting",[!0]);ia.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");
break;case 4:I.execute("setTouchRemoting",[!1]),ia.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};l.addDynamicChannel(F)}if(d){svGlobal.logger.warn("Audio input on");var S=new l.DynamicChannel;(function(){function u(Y){var ea=new RdpBuffer(new Uint8Array(5),0,5);ea.setByte(7);ea.setLittleEndian32(Y);ea.markEnd();S.send(ea)}function p(Y){var ea=Y.getLittleEndian32(),Ga=Y.getLittleEndian32(),za=new f;za.fromBuffer(Y,!0);var Fa=0,Ya=0;0<za.cbSize&&(22==za.cbSize?(Fa=Y.getLittleEndian16(),
Ya=Y.getLittleEndian32(),Y.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+za.cbSize),Y.skipPosition(za.cbSize)));Y=r[Ga];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+ea+" initial: "+Ga+", "+Y.toString());svGlobal.logger.info("Open fmt: "+za.toString()+" validBits:"+Fa+" mask:"+Ya);H=!0;R=l.reconnectOnResize;l.reconnectOnResize=!1;na.onopen||(na.onopen=function(Ba){if(oa){A=Ba;l.reconnectOnResize=R;u(Ga);var Ca=new RdpBuffer(new Uint8Array(5),0,5);Ca.setByte(4);Ca.setLittleEndian32(Ba?
0:1);Ca.markEnd();S.send(Ca)}});na.ondata||(na.ondata=function(Ba,Ca){A&&(T.length!=Ca+1&&(T=new Uint8Array(Ca+1),T[0]=6),S.send(J),T.set(Ba,1),S.send(T))});na.start(Y,ea)}S.name="AUDIO_INPUT";S.process=function(Y){var ea=Y.getByte();switch(ea){case 1:Y=Y.getLittleEndian32();ea=new RdpBuffer(new Uint8Array(5),0,5);ea.setByte(1);ea.setLittleEndian32(Y);ea.markEnd();S.send(ea);break;case 2:var Ga=Y.getLittleEndian32();Y.getLittleEndian32();var za=ua.getContext().sampleRate;for(ea=r.length=0;ea<Ga;ea++){var Fa=
new f;Fa.fromBuffer(Y);svGlobal.logger.info("Server rec fmt "+ea+":"+Fa.toString());0==e&&49==Fa.formatTag&&22050==Fa.nSamplesPerSec?r.push(Fa):1==Fa.formatTag&&Fa.nSamplesPerSec<=za&&r.push(Fa)}S.send(J);Ga=0;Y=r.length;for(ea=0;ea<Y;ea++)Ga+=r[ea].getSize();za=new RdpBuffer(new Uint8Array(1024),0,1024);za.setByte(2);za.setLittleEndian32(Y);za.setLittleEndian32(Ga+9);for(ea=0;ea<Y;ea++)r[ea].toBuffer(za),svGlobal.logger.info("Client rec fmt: "+r[ea].toString());za.skipPosition(1024-Ga-9);za.markEnd();
S.send(za);break;case 3:p(Y);break;case 7:ea=Y.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+r[ea].toString()+" by client:"+H);H||(u(ea),H=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+ea)}};var A=!1,r=[];S.onclose=function(){A=!1;na&&na.close()};var J=new Uint8Array(1);J[0]=5;var H=!1,R=l.reconnectOnResize,T=new Uint8Array(0),ja=N("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),na=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(ua.getContext(),
ja):new hi5.audio.Recorder(ua.getContext())})();l.addDynamicChannel(S)}l.addDynamicChannel(function(){var u=new l.DynamicChannel;u.name="TSMF";var p={type:"image/jpeg"},A=Array(1);u.process=function(r){r.getPosition();var J=r.getLittleEndian32()&1073741823;var H=r.getLittleEndian32();var R=r.getLittleEndian32();switch(J){case 2:if(256==R){r.getLittleEndian32();R=new Uint8Array(16);var T=new RdpBuffer(R,0,16);T.setLittleEndian32(2);T.setLittleEndian32(H);T.setLittleEndian32(1);T.setLittleEndian32(0);
u.send(R)}break;case 0:switch(R){case 257:r.getBytes(16);r.getLittleEndian32();break;case 256:J=r.getPosition();T=r.getLittleEndian32();for(R=0;R<T;R++){r.getLittleEndian32();var ja=r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(ja-4)}R=r.getPosition()-J;T=R+8+4;R=new Uint8Array(T);T=new RdpBuffer(R,0,T);T.setLittleEndian32(-2147483648);T.setLittleEndian32(H);R.set(r.getData().subarray(J,r.getPosition()),8);u.send(R);break;case 261:r.getBytes(16);r.getLittleEndian32();break;case 264:J=
r.getLittleEndian32();r.skipPosition(4);r.getLittleEndian32();ja=r.getBytes(16);var na=r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.getLittleEndian32();var Y=r.getBytes(16);R=r.getLittleEndian32();r.skipPosition(R);R=new Uint8Array(20);T=new RdpBuffer(R,0,20);T.setLittleEndian32(-2147483648);T.setLittleEndian32(H);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],ja)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],na)&&hi5.Arrays.equals([128,
159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],Y)?T.setLittleEndian32(1):(T.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(ja),svGlobal.logger.warn(na),svGlobal.logger.warn(Y));T.setLittleEndian32(J);u.send(R);break;case 258:r.getBytes(16);r.getLittleEndian32();J=r.getLittleEndian32();r.skipPosition(J);break;case 263:r.getBytes(16),R=new Uint8Array(16),T=new RdpBuffer(R,0,16),T.setLittleEndian32(-2147483648),T.setLittleEndian32(H),T.setLittleEndian32(1),
u.send(R);case 277:r.getBytes(16);r.getLittleEndian32();break;case 262:r.getBytes(16);W.flushImgs();W.setImgRect(0,0,0,0);R=new Uint8Array(12);T=new RdpBuffer(R,0,12);T.setLittleEndian32(-2147483648);T.setLittleEndian32(H);u.send(R);break;case 278:r.getBytes(16);H=r.getLittleEndian32();R=r.getLittleEndian32();J=r.getLittleEndian32();r=r.getLittleEndian32();W.setImgRect(H,R,J-H,r-R);break;case 265:r.getBytes(16);r.getLittleEndian64();r.getLittleEndian32();break;case 266:r.getBytes(16);break;case 268:r.getBytes(16);
break;case 267:r.getBytes(16);break;case 269:r.getBytes(16);r.getLittleEndian32();break;case 274:break;case 275:break;case 259:r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(32);R=r.getLittleEndian32();H=new Image;J=r.getPosition();A[0]=r.getData().subarray(J,J+R);r=new Blob(A,p);H.src=URL.createObjectURL(r);W.addImg(H);break;case 270:W.flushImgs();break;case 273:break;case 260:break;case 276:r.getBytes(16);R=r.getLittleEndian32();J=r.getPosition()+R;r.skipPosition(8);H=
r.getLittleEndian32();svGlobal.logger.info("window state:"+H);T=r.getLittleEndian32();ja=r.getLittleEndian32();H=r.getLittleEndian32();R=r.getLittleEndian32();r.skipPosition(8);na=r.getLittleEndian32();Y=r.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+H+" top:"+R+" w:"+T+" h:"+ja+" cl:"+na+" ct:"+Y);r.setPosition(J);J=r.getLittleEndian32();for(J=r.getPosition()+J;r.getPosition()<J;){na=r.getLittleEndian32();Y=r.getLittleEndian32();var ea=r.getLittleEndian32(),Ga=r.getLittleEndian32();
svGlobal.logger.info("visible region, l:"+Y+" t:"+na+" r:"+Ga+" b:"+ea)}W.setImgRect(H,R,T,ja);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+R)}break;default:svGlobal.logger.warn("unkown interface:"+J)}};return u}());Xa||l.addDynamicChannel(B());K.enableDVCAudio&&l.addDynamicChannel(function(u){var p=!1,A=0,r=0,J=0,H=0,R=[],T=new Uint8Array(4),ja=new l.DynamicChannel;ja.name="AUDIO_PLAYBACK_DVC";ja.onclose=function(){};ja.process=function(na){function Y(X){X.skipPosition(14);
var da=X.getLittleEndian16();X.getByte();var ra=X.getLittleEndian16();X.skipPosition(1);for(var Na,Ia=R.length=0;Ia<da;Ia++){var La=new f;La.fromBuffer(X);(Na=22050<=La.nSamplesPerSec&&(1==La.formatTag||49==La.formatTag&&22050==La.nSamplesPerSec&&0==u))&&R.push(La)}La=20;X=R.length;for(Ia=0;Ia<X;Ia++)La+=R[Ia].getSize();Ia=La+4;da=new RdpBuffer(new Uint8Array(Ia),0,Ia);da.setByte(7);da.setByte(2);da.setLittleEndian16(La);da.setLittleEndian32(3);da.setLittleEndian32(4294967295);da.setLittleEndian32(0);
da.setLittleEndian16(0);da.setLittleEndian16(X);da.skipPosition(1);da.setLittleEndian16(ra);da.setByte(124);for(Ia=0;Ia<X;Ia++)La=R[Ia],La.toBuffer(da);da.markEnd();ja.send(da);5<ra&&(da=new RdpBuffer(new Uint8Array(8),0,8),da.setByte(12),da.skipPosition(1),da.setLittleEndian16(4),da.setLittleEndian16(0),da.setLittleEndian16(0),da.markEnd(),ja.send(da))}function ea(X){var da=X.getLittleEndian16();X=X.getLittleEndian16();var ra=new RdpBuffer(new Uint8Array(8),0,8);ra.setByte(6);ra.setByte(35);ra.setLittleEndian16(4);
ra.setLittleEndian16(da);ra.setLittleEndian16(X);ra.markEnd();ja.send(ra)}function Ga(){var X=R[J];if(X.formatTag!=V||X.nSamplesPerSec!=Wa||ka!=X.nChannels)V=X.formatTag,ka=X.nChannels,Wa=X.nSamplesPerSec,db=49==X.formatTag?8:X.bitsPerSample}function za(X){r=X.getLittleEndian16();J=X.getLittleEndian16();H=X.getByte();X.skipPosition(3);T[0]=X.getByte();T[1]=X.getByte();T[2]=X.getByte();T[3]=X.getByte();p=!0;Ga()}function Fa(X,da){var ra=new RdpBuffer(new Uint8Array(8),0,8);ra.setByte(5);ra.skipPosition(1);
ra.setLittleEndian16(4);ra.setLittleEndian16(X);ra.setByte(da);ra.skipPosition(1);ra.markEnd();ja.send(ra)}function Ya(X){p=!1;var da=A-8,ra=Date.now();X.copyFromByteArray(T,0,X.getPosition(),4);X=Wb(X,H,r,da);X=1E3*(X-ua.delay);ra=r+(Date.now()-ra)+X;Fa(ra,H)}function Ba(X){var da=Date.now();r=X.getLittleEndian16();J=X.getLittleEndian16();H=X.getByte();X.skipPosition(7);Ga();X=Wb(X,H,r,0);X=1E3*(X-ua.delay);da=r+(Date.now()-da)+X;Fa(da,H)}if(p)Ya(na);else{var Ca=na.getByte();na.skipPosition(1);A=
na.getLittleEndian16();switch(Ca){case 7:Y(na);break;case 6:ea(na);break;case 2:za(na);break;case 1:closed=!0;break;case 3:na.getLittleEndian16();na.getLittleEndian16();break;case 13:Ba(na)}}};return ja}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var z=svGlobal.DCVC_EXTENSION;z.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(u,p){svGlobal.logger.info("activate webcam");z.videoMedia.resolutions?u():hi5.video.resolutions(function(A){A.length?
(z.videoMedia.resolutions=A,u()):p()})},deactivate:function(){var u=z.videoMedia;u.track&&(u.track.stop(),u.track=null);u.ctx=null;u.canvas=null;u.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(u,p,A,r,J){svGlobal.logger.info("startStream, width:"+u+" height:"+p+" frameRate:"+A);var H=z.videoMedia,R=H.track;if(R){var T=R.getSettings();if("live"==R.readyState)if(u!=T.width||p!=T.height||A!=T.frameRate&&2!=H.type)R.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==
H.type?H.minFrameRate:A,width:{exact:u},height:{exact:p}}}).then(function(ja){var na=document.createElement("video");na.srcObject=ja;na.play();if(window.OffscreenCanvas)var Y=new OffscreenCanvas(100,100);else Y=document.createElement("canvas"),Y.style.position="absolute",Y.style.left=0,Y.style.top=0;H.track=ja.getVideoTracks()[0];H.canvas=Y;H.ctx=Y.getContext("2d");H.video=na;ja=H.track.getSettings();H.canvas.width=ja.width;H.canvas.height=ja.height;r()}).catch(function(ja){svGlobal.logger.warn(ja);
J()})},stopStream:function(){svGlobal.logger.info("stopStream");var u=z.videoMedia;u.track&&"live"==u.track.readyState&&u.track.stop()},grabFrame:function(u){function p(r){r.arrayBuffer().then(u)}var A=z.videoMedia;A.ctx.drawImage(A.video,0,0);A=A.canvas;A.convertToBlob?A.convertToBlob({type:"image/jpeg",quality:.6}).then(p):A.toBlob(p,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:101,min:4294967280,
max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:199,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:67,
min:2800,max:6500,step:1,default:4600}]]};z.WEBCAM=function(u){var p=new u;p.name="RDCamera_Device_0";p.version=2;p.newInstance=function(){return z.WEBCAM(u)};p.onopen=function(){svGlobal.logger.info("cam open")};p.onclose=function(){svGlobal.logger.info("cam close")};p.sendSucess=function(){var A=new hi5.DataBuffer(new Uint8Array(2));A.setByte(p.version);A.setByte(1);A.markEnd();p.send(A)};p.sendError=function(A){var r=new hi5.DataBuffer(new Uint8Array(6));r.setByte(p.version);r.setByte(2);r.setLittleEndian32(A||
1);r.markEnd();p.send(r)};p.sendSteamListResp=function(){var A=new hi5.DataBuffer(new Uint8Array(7));A.setByte(p.version);A.setByte(10);A.setLittleEndian16(1);A.setByte(1);A.setByte(1);A.setByte(0);A.markEnd();p.send(A)};p.sendMediaTypeListResp=function(A){var r=z.videoMedia.resolutions,J=r.length,H=new hi5.DataBuffer(new Uint8Array(2+26*J));H.setByte(p.version);H.setByte(12);for(var R=1==A,T=0;T<J;T++){H.setByte(A);var ja=r[T];H.setLittleEndian32(ja.width);H.setLittleEndian32(ja.height);H.setLittleEndian32(R?
ja.frameRate:z.videoMedia.minFrameRate);H.setLittleEndian32(1);H.setLittleEndian32(1);H.setLittleEndian32(1);H.setByte(1)}H.markEnd();p.send(H)};p.sendCurrentMediaType=function(A,r){var J=new hi5.DataBuffer(new Uint8Array(28));J.setByte(p.version);J.setByte(14);r=z.videoMedia.resolutions[r];J.setByte(A);J.setLittleEndian32(r.width);J.setLittleEndian32(r.height);J.setLittleEndian32(1==A?r.frameRate:z.videoMedia.minFrameRate);J.setLittleEndian32(1);J.setLittleEndian32(1);J.setLittleEndian32(1);J.setByte(1);
J.markEnd();p.send(J)};p.sendSampleResp=function(A){z.videoMedia.grabFrame(function(r){var J=new hi5.DataBuffer(new Uint8Array(r.byteLength+3));J.setByte(p.version);J.setByte(18);J.setByte(A);J.setBytes(new Uint8Array(r));J.markEnd();p.send(J)})};p.sendPropertyListResp=function(){for(var A=0,r,J,H=z.videoMedia.propertyList,R=0;2>R;R++){J=H[R];r=J.length;for(var T=0;T<r;T++)null!=J[T]&&A++}A=new hi5.DataBuffer(new Uint8Array(2+19*A));A.setByte(p.version);A.setByte(21);for(R=0;2>R;R++)for(J=H[R],r=
J.length,T=0;T<r;T++)null!=J[T]&&(A.setByte(R),A.setByte(J.propertyId),A.setByte(J.capabilities),A.setLittleEndian32(J.min),A.setLittleEndian32(J.max),A.setLittleEndian32(J.step),A.setLittleEndian32(J.default));A.markEnd();p.send(A)};p.sendPropertyValueResp=function(A,r){(A=z.videoMedia.propertyList[A][r-1])?(r=new hi5.DataBuffer(new Uint8Array(7)),r.setByte(p.version),r.setByte(23),r.setByte(1),r.setLittleEndian32(A.value||A.default),r.markEnd(),p.send(r)):p.sendError(8)};p.process=function(A){A.getByte();
var r=A.getByte();switch(r){case 7:z.videoMedia.activate(p.sendSucess,p.sendError);break;case 8:z.videoMedia.deactivate();p.sendSucess();break;case 9:p.sendSteamListResp();break;case 11:A=A.getByte();0!=A&&svGlobal.logger.warn("Invalid stream index: "+A);p.sendMediaTypeListResp(z.videoMedia.type);break;case 13:A=A.getByte();p.sendCurrentMediaType(z.videoMedia.type,A);break;case 15:A.getByte();r=A.getByte();if(r!=z.videoMedia.type){svGlobal.warn("Invalid video format req:"+r);p.sendError(6);break}r=
A.getLittleEndian32();var J=A.getLittleEndian32();A=A.getLittleEndian32()/A.getLittleEndian32();z.videoMedia.startStream(r,J,A,p.sendSucess,p.sendError);break;case 16:z.videoMedia.stopStream();p.sendSucess();break;case 17:A=A.getByte();0!=A&&svGlobal.log("Invalid stream index for SampleRequest: "+A);p.sendSampleResp(A);break;case 20:p.sendPropertyListResp();break;case 22:r=A.getByte();A=A.getByte();p.sendPropertyValueResp(r,A);break;case 24:p.sendError(10);break;default:p.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+
r)}};return p};z.WEBCAM_ENUM=function(u,p){var A=new u;A.name="RDCamera_Device_Enumerator";A.onopen=function(){var r=new hi5.DataBuffer(new Uint8Array(2));r.setByte(p.version);r.setByte(3);r.markEnd();A.send(r);svGlobal.logger.info("camEnum open")};A.onclose=function(){svGlobal.logger.info("camEnum closed");z.videoMedia.deactivate()};A.addDevice=function(r){r+="\x00";var J=p.name+"\x00",H=new hi5.DataBuffer(new Uint8Array(2+2*r.length+J.length));H.setByte(p.version);H.setByte(5);H.setUnicodeString(r);
H.setAscllString(J);H.markEnd();A.send(H)};A.process=function(r){var J=r.getByte();r=r.getByte();switch(r){case 4:svGlobal.logger.info("camEnum ver resp: "+J);p.version=J;A.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+r)}};return A};c&&(a=z.WEBCAM(l.DynamicChannel),b=z.WEBCAM_ENUM(l.DynamicChannel,a),l.addDynamicChannel(b),l.addDynamicChannel(a));m&&(svGlobal.logger.info("Mapping USB..."),l.addDynamicChannel(ia.usbChannel))}}},
Sa=null;svGlobal.DCVC_EXTENSION&&!Xa&&(l.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(ia.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(l.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(Sa=svGlobal.DCVC_EXTENSION.DRIVE(l.GatewayChannel),l.addGatewayChannel(Sa)));this.getPrinters=function(a){if(!l.onagentmessage||!Sa)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();l.onagentmessage(b.getData());Sa.listCallback=a};this.attachPrinter=function(a){Sa&&Sa.attachPrinter(a,
l)};this.showError=tb;this.resetStatus=Kb;this.exeAppCmd=function(a){var b=I.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?I.getWinById(a):I.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,d){void 0==d&&(d=K.forceReconnect||!1);if(!oa&&!d)return!1;E.minWidth&&a<E.minWidth&&(a<E.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+E.minWidth),a=E.minWidth);E.minHeight&&b<E.minHeight&&
(b<E.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+E.minHeight),b=E.minHeight);a&=-4;b&=-4;if(!d&&4>Math.abs(a-pa)&&4>Math.abs(b-qa))return!1;if(ya&&ya.enabled&&!1!==K.displayVC)ya.applyResolution(a,b);else if(Xb&&gb||d||Ka&&!Xb)gb=!1,svGlobal.logger.info("reconnecting..."),ba("8E0"+a+"\t"+b),xa&&(xa.remoteLockFlags=0,xa.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));ba(a)};this.getUploadManager=function(){return ta};this.addSurface=
function(a){if(!I.hasSurface(a)&&(xb||W.setContext(a.context),!I.hasSurface(a)||!a.railWin)){Xa&&a.setPlayerMode();E.mouseMoveEmu&&(a.mouseMoveEmu=Z(E.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==pa&&(pa=b.width);0==qa&&(qa=b.height);a.setConfig(K);I.addSurface(a);fb(pa,qa,!0,E.monitorDef?!0:!1);a.setController(xa);a.setTouchpad(Z(E.touchpad));var d=b=Z(E.mapClipboard),e=b;void 0!=E.copyToLocal?d=Z(E.copyToLocal):void 0!=K.copyToLocal&&(d=K.copyToLocal);void 0!=E.copyToRemote?
e=Z(E.copyToRemote):void 0!=K.copyToRemote&&(e=K.copyToRemote);a.setClipboard(b,d,e);wb&&Lb(a);E.invitation&&!Z(E.control)&&(I.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=E.ctrlToWin?Z(E.ctrlToWin):void 0!=K.ctrlToWin?K.ctrlToWin:!0;d=void 0!=E.cmdToCtrl?Z(E.cmdToCtrl):void 0!=K.cmdToCtrl?K.cmdToCtrl:!0;a.run(parseInt(E.keyboard||1033,10),b,!!K.noKeyStuck,d)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,d=I.size();b<d;b++)I.getSurface(b).railWin.getMain(I.zOrders)&&
a.push(I.getSurface(b).railWin.getMain(I.zOrders).titleInfo);return a};this.startApp=function(a,b,d){b=b||"";d=d||"";ba("8C2"+a+"\t"+b+"\t"+d);var e=I.getSurface(I.size()-1);e&&(e.remoteApp=new ac(a,b,d))};this.startExitingApp=function(a){a=I.popWins(a);for(var b=a.length-1;0<=b;b--)I.addWin(a[b])};var lb=new l.DynamicChannel;lb.name="PNPDR";lb.onopen=function(){console.log("PNPDR DVC onopen()")};lb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),
a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),lb.send(a)}};lb.onclose=function(){console.log("PNPDR DVC onclose()")};l.addDynamicChannel(lb);var $a=null;Z(E.scanner)&&($a=new l.DynamicChannel,$a.name="SCANNERDVC",$a.onopen=function(){console.log("scanner DVC onopen().")},$a.process=function(a){var b=a.getByte();switch(b){case 0:var d=a.getByte(),
e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=d;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(l.onagentmessage)l.onagentmessage(b);break;case 1:break;case 2:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+2);b[0]=4;b[1]=3;b.set(a.getBytes(d),2);if(l.onagentmessage)l.onagentmessage(b);break;case 3:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(d),3);if(l.onagentmessage)l.onagentmessage(b);break;default:console.log('Warning: Unknown type "'+
b+'" received from DVC, ignored.')}},$a.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(l.onagentmessage)l.onagentmessage(a)},l.addDynamicChannel($a));var Oa=null;l.hasSmartCard()&&(Oa=new l.GatewayChannel,Oa.name="SCARDSTB",Oa.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(l.onagentmessage)l.onagentmessage(a);Z(E.passwordIsPin)&&l.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",
type:0,timeout:1E4})},Oa.process=function(a){var b=a.getEnd()-a.getPosition(),d=a.getByte(),e=a.getByte();switch(d){case 1:switch(e){case 1:d=new Uint8Array(2);d[0]=3;d[1]=7;if(l.onagentmessage)l.onagentmessage(d);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;mb&&(b+=mb.length);Ta&&(b+=Ta.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);mb?(b.setLittleEndian32(mb.length),b.setBytes(mb)):b.setLittleEndian32(0);Ta?(b.setLittleEndian32(Ta.length),b.setBytes(Ta)):b.setLittleEndian32(0);
b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(l.onagentmessage)l.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);d=new Uint8Array(b);d[0]=3;d[1]=11;d.set(a,2);if(l.onagentmessage)l.onagentmessage(d);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(Oa)if(1==e){if(d=new Uint8Array(b),d[0]=3,d[1]=3,d.set(a.getBytes(b),2),l.onagentmessage)l.onagentmessage(d)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+
a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},Oa.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(l.onagentmessage)l.onagentmessage(a)},l.addGatewayChannel(Oa));K.detectNetwork&&(v+="&connectType=7",Cc());this.getNetworkResult=function(){return ub};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":
-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var Mb=new Map,Nb=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(Oa){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;Oa.send(a);break;case 8:Mb.clear();Nb.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,
!1),hi5.notifications.notify({msg:b});else{var d=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==d)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<d?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':
'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<d;a++){var c=b.getLittleEndian32();c=b.getBytes(c);var m=b.getLittleEndian32();m=b.getAscllString(m,!1);var f=b.getLittleEndian32();f=b.getAscllString(f,!1);var B=b.getLittleEndian32();b.getAscllString(B,!1);B=b.getLittleEndian64();B=(new Date(1E3*B)).toDateString();c=Dc(a,c,f,m,B);e.appendChild(c)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");
a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var D,F=document.querySelector('input[name="scard_name"]:checked');F&&(D=parseInt(F.value));mb=Mb.get(D);ib=Nb.get(D);D=document.getElementById("userPin").value;Ta=(new TextEncoder("utf-8")).encode(D);D=2;D=Ta?D+4+Ta.length:D+4;D=ib?D+4+ib.length:D+4;D=new Uint8Array(D);D=new hi5.DataBuffer(D);D.setByte(1);D.setByte(2);
Ta?(D.setLittleEndian32(Ta.length),D.setBytes(Ta)):D.setLittleEndian32(0);ib?(D.setLittleEndian32(ib.length),D.setAsciiString(ib,ib.length)):D.setLittleEndian32(0);Oa&&Oa.send(D)};document.getElementById("userPin").addEventListener("keypress",function(D){"Enter"===D.key&&(D.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),
a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),Oa.send(b));break;case 12:a[0]=1;a[1]=6;Oa.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if($a)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),
e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){l.run()},b.show());else if(d=(a.byteLength-4)/41,0==d)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){l.run()},b.show());else if(1==d){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,l.onagentmessage)l.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<d;a++)c=b.getAscllString(41,!0),c=Ec(a,c),e.appendChild(c);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var D=0,F=document.querySelector('input[name="ds_name"]:checked');F&&(D=F.value);F=new Uint8Array(3);
F[0]=4;F[1]=5;F[2]=D;if(l.onagentmessage)l.onagentmessage(F)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));$a.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));$a.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();
l.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=l.getAgentLink(),hi5.notifications.notify({title:b,
msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();d=[];for(a=0;a<e;a++)m=b.getLittleEndian32(),c=b.getUnicodeString(m),m=b.getLittleEndian32(),m=b.getUnicodeString(m),d.push({name:c,driver:m});Sa&&Sa.listCallback&&(Sa.listCallback(d),Sa.listCallback=null)}break;case 7:Sa.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var mb,Ta,ib,Qb={type:6,
data:null};this.setAgentStatus=function(a){tc=a};this.getAgentStatus=function(){return tc};this.run=function(){var a;if(a=null==l.onagentmessage)a=1==l.mode?!1:l.hasSmartCard()||l.hasScanner()||Z(E.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(l):(l.hasUSB()?I.getFocused().requestUsbDevices(l.getUSB(),function(b){ia.usbChannel.openDevices(b);Ob()}):Ob(),ua.supportWebAudio&&ua.iOSFix())};this.getDesktop=function(){return W};this.mouseDown=function(a,b,d){Ka&&ba("80"+a+"\t"+b+"\t"+d)};
this.mouseMove=function(a,b){Ka&&ba("82"+a+"\t"+b)};this.mouseUp=function(a,b,d){Ka&&ba("81"+a+"\t"+b+"\t"+d)};this.writeKeyCode=function(a,b){Ka&&ba("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Ka&&("number"==typeof a?(ba("840\t"+a),ba("8449152\t"+a)):ba("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){l.reconnectOnResize&&(Ja?(eb&&(clearTimeout(eb),eb=0),a&=-4,b&=-4,eb=setTimeout(function(){ya&&ya.enabled&&ya.applyResolution(a,b);setTimeout(function(){l.writeRawInput("8C661441\t"+
a+"\t"+b);sc()},150);svGlobal.logger.info("-- displayChange, h:"+b)},777)):l.running()&&(eb&&(clearTimeout(eb),eb=0),eb=setTimeout(function(){l.reconnect(a,b)},555)))};var Ea=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!l.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Eb,b[4]=Eb>>8,b[5]=Db,b[6]=Db>>8,b[7]=Fb,b[8]=Fb>>8,b[9]=Gb,b[10]=Gb>>8);ba(b.buffer);return!0};this.refreshOutput=function(a,b,d,e){var c=new Uint8Array(d?
11:3);c[0]=146;c[1]=3;c[2]=2;d&&(c[3]=a,c[4]=a>>8,c[5]=b,c[6]=b>>8,c[7]=d,c[8]=d>>8,c[9]=e,c[10]=e>>8);ba(c.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ba(b.buffer)};this.startPing=function(a,b){b=b||0;wa||(wa=new hi5.tool.ResponseMonitor(function(){Ka&&l.sendPing()},function(){if(Ka&&l.onnoresponse)return l.onnoresponse()}));wa.setInterval(a,b);var d=new Uint8Array(4);d[0]=146;d[1]=2;d[2]=a;d[3]=b;ba(d.buffer);setTimeout(function(){wa&&wa.check()},
1E3*(a+b));sa?sa.postMessage({type:0,cmd:6,start:1}):(fa.onSlowPath=fa.onFastPath=ic,fa.onReqHistory=function(){ic(15555)})};this.stopPing=function(){wa&&wa.stop();sa?sa.postMessage({type:0,cmd:6,start:0}):fa.onSlowPath=fa.onFastPath=fa.onReqHistory=null};var Ma=null,pc=0;this.play=function(){ba("F3")};this.pause=function(){ba("F2")};this.scan=function(a){ba("F4"+(a?"1":"0"))};this.seek=function(a){var b=I.getFocused();b&&oa&&(ba("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),W.pause(!0))};var db=ka=
V=0;var Wa=22050;var oc=!1;this.showMessage=function(a,b,d){l&&l.displayMsg&&a&&((b=b||I.getFocused())?b.showMessage(a,d):("string"==typeof a&&(a={msg:a,timeout:d||0}),hi5.notifications.notify(a)))};this._unload=ob;this.close=function(){svGlobal.logger.info("closing...");oa&&Ja&&I&&K.closeRemoteApp&&I.tryCloseRemoteApps();W&&W.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(rc,2222)):rc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(l.close):
window.addEventListener("unload",l.close,!1)}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var v=navigator&&(navigator.language||navigator.userLanguage||""),L=Rdp.languageToKeyboard[v];if(!L){var P=v.indexOf("-");P&&(L=Rdp.languageToKeyboard[v.substring(0,P)])}L||(console.log("No valid layout for "+v),L=1033);return L}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
